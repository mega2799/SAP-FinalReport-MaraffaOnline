<!doctype html>
<html >
<head>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <!--[if lt IE 9]>
                <script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
        <![endif]-->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />

    <!-- <link rel="stylesheet" type="text/css" href="template.css" /> -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/template.css" />

    <link href="https://vjs.zencdn.net/5.4.4/video-js.css" rel="stylesheet" />

    <script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>
    <!-- <script type='text/javascript' src='menu/js/jquery.cookie.js'></script> -->
    <!-- <script type='text/javascript' src='menu/js/jquery.hoverIntent.minified.js'></script> -->
    <!-- <script type='text/javascript' src='menu/js/jquery.dcjqaccordion.2.7.min.js'></script> -->

    <!-- <link href="menu/css/skins/blue.css" rel="stylesheet" type="text/css" /> -->
    <!-- <link href="menu/css/skins/graphite.css" rel="stylesheet" type="text/css" /> -->
    <!-- <link href="menu/css/skins/grey.css" rel="stylesheet" type="text/css" /> -->
  
    <!-- <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> -->
        
  
    <!-- <script src="script.js"></script> -->
  
    <!-- <script src="jquery.sticky-kit.js "></script> -->
    <script type='text/javascript' src='https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/js/jquery.cookie.js'></script>
    <script type='text/javascript' src='https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/js/jquery.hoverIntent.minified.js'></script>
    <script type='text/javascript' src='https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/js/jquery.dcjqaccordion.2.7.min.js'></script>

    <link href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/css/skins/blue.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/css/skins/graphite.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/css/skins/grey.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/gh/ryangrose/easy-pandoc-templates@948e28e5/css/elegant_bootstrap.css" rel="stylesheet" type="text/css" />
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  
    <script src="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/script.js"></script>
  
    <script src="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/jquery.sticky-kit.js"></script>
    <meta name="generator" content="pandoc" />
  <title>Relazione progetto MaraffaOnline - SAP</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #ffffff;
    color: #a0a0a0;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
div.sourceCode
  { color: #1f1c1b; background-color: #ffffff; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #1f1c1b; } /* Normal */
code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
code span.an { color: #ca60ca; } /* Annotation */
code span.at { color: #0057ae; } /* Attribute */
code span.bn { color: #b08000; } /* BaseN */
code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code span.ch { color: #924c9d; } /* Char */
code span.cn { color: #aa5500; } /* Constant */
code span.co { color: #898887; } /* Comment */
code span.cv { color: #0095ff; } /* CommentVar */
code span.do { color: #607880; } /* Documentation */
code span.dt { color: #0057ae; } /* DataType */
code span.dv { color: #b08000; } /* DecVal */
code span.er { color: #bf0303; text-decoration: underline; } /* Error */
code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code span.fl { color: #b08000; } /* Float */
code span.fu { color: #644a9b; } /* Function */
code span.im { color: #ff5500; } /* Import */
code span.in { color: #b08000; } /* Information */
code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code span.op { color: #1f1c1b; } /* Operator */
code span.ot { color: #006e28; } /* Other */
code span.pp { color: #006e28; } /* Preprocessor */
code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #ff5500; } /* SpecialString */
code span.st { color: #bf0303; } /* String */
code span.va { color: #0057ae; } /* Variable */
code span.vs { color: #bf0303; } /* VerbatimString */
code span.wa { color: #bf0303; } /* Warning */
  </style>
</head>
<body>

    
    <div class="navbar navbar-static-top">
    <div class="navbar-inner">
      <div class="container">
        <span class="doc-title">Relazione progetto MaraffaOnline -
SAP</span>
        <ul class="nav pull-right doc-info">
                            </ul>
      </div>
    </div>
  </div>
    <div class="container">
    <div class="row">
            <div id="TOC" class="span3">
        <div class="well toc">

        <ul>
        <li><a href="#declaration" id="toc-declaration">Declaration</a>
        <ul>
        <li><a href="#list-of-abbreviations"
        id="toc-list-of-abbreviations">List of Abbreviations</a></li>
        </ul></li>
        <li><a href="#ch:into" id="toc-ch:into">Introduction</a></li>
        <li><a href="#ch:decomposition"
        id="toc-ch:decomposition">Decomposizione da monolite a
        micro-servizi (Assignment 5)</a>
        <ul>
        <li><a href="#introduzione-e-contesto"
        id="toc-introduzione-e-contesto">Introduzione e
        contesto</a></li>
        <li><a href="#operazioni-di-sistema"
        id="toc-operazioni-di-sistema">Operazioni di sistema</a>
        <ul>
        <li><a
        href="#knowledge-crunching-session-for-the-exploration-of-the-problem-space"
        id="toc-knowledge-crunching-session-for-the-exploration-of-the-problem-space">Knowledge
        crunching session for the exploration of the problem
        space</a></li>
        <li><a href="#casi-duso" id="toc-casi-duso">Casi d’uso</a></li>
        </ul></li>
        <li><a href="#decomposizione-in-servizi"
        id="toc-decomposizione-in-servizi">Decomposizione in servizi</a>
        <ul>
        <li><a href="#strategia-decompose-by-subdomain-ddd"
        id="toc-strategia-decompose-by-subdomain-ddd">Strategia:
        Decompose by Subdomain (DDD)</a></li>
        <li><a href="#bounded-context" id="toc-bounded-context">Bounded
        Context</a></li>
        <li><a href="#architettura-dei-microservizi"
        id="toc-architettura-dei-microservizi">Architettura dei
        microservizi</a></li>
        <li><a href="#schema-architettura"
        id="toc-schema-architettura">Schema architettura</a></li>
        </ul></li>
        <li><a href="#pattern-architetturali-applicati"
        id="toc-pattern-architetturali-applicati">Pattern architetturali
        applicati</a>
        <ul>
        <li><a href="#api-gateway-pattern"
        id="toc-api-gateway-pattern">API Gateway Pattern</a></li>
        <li><a href="#database-per-service-pattern"
        id="toc-database-per-service-pattern">Database per Service
        Pattern</a></li>
        </ul></li>
        <li><a href="#comunicazione-tra-servizi"
        id="toc-comunicazione-tra-servizi">Comunicazione tra servizi</a>
        <ul>
        <li><a href="#api-gateway" id="toc-api-gateway">API
        Gateway</a></li>
        <li><a href="#websocket-per-comunicazione-real-time"
        id="toc-websocket-per-comunicazione-real-time">WebSocket per
        comunicazione Real-Time</a></li>
        </ul></li>
        <li><a href="#deployment-e-devops"
        id="toc-deployment-e-devops">Deployment e DevOps</a>
        <ul>
        <li><a href="#containerizzazione"
        id="toc-containerizzazione">Containerizzazione</a></li>
        <li><a href="#stack-docker-e-reti"
        id="toc-stack-docker-e-reti">Stack Docker e reti</a></li>
        <li><a href="#struttura-repository"
        id="toc-struttura-repository">Struttura repository</a></li>
        <li><a href="#continuous-integration"
        id="toc-continuous-integration">Continuous Integration</a></li>
        <li><a href="#monitoraggio"
        id="toc-monitoraggio">Monitoraggio</a></li>
        </ul></li>
        <li><a href="#documentazione-e-testing"
        id="toc-documentazione-e-testing">Documentazione e testing</a>
        <ul>
        <li><a href="#swagger-openapi" id="toc-swagger-openapi">Swagger
        / OpenAPI</a></li>
        <li><a href="#postman-e-testing"
        id="toc-postman-e-testing">Postman e testing</a></li>
        <li><a href="#sistema-di-logging"
        id="toc-sistema-di-logging">Sistema di Logging</a></li>
        </ul></li>
        <li><a href="#vantaggi-e-sfide"
        id="toc-vantaggi-e-sfide">Vantaggi e sfide</a>
        <ul>
        <li><a href="#vantaggi-dellarchitettura"
        id="toc-vantaggi-dellarchitettura">Vantaggi
        dell’architettura</a></li>
        <li><a href="#sfide-incontrate" id="toc-sfide-incontrate">Sfide
        incontrate</a></li>
        </ul></li>
        <li><a href="#conclusioni"
        id="toc-conclusioni">Conclusioni</a></li>
        </ul></li>
        <li><a href="#chap:QA" id="toc-chap:QA">Quality Attributes</a>
        <ul>
        <li><a href="#operational"
        id="toc-operational">Operational</a></li>
        <li><a href="#structural"
        id="toc-structural">Structural</a></li>
        </ul></li>
        <li><a href="#ch:testing" id="toc-ch:testing">Testing</a>
        <ul>
        <li><a href="#strumenti-di-testing"
        id="toc-strumenti-di-testing">Strumenti di Testing</a></li>
        <li><a
        href="#architettura-dei-componenti-e-strategia-di-testing"
        id="toc-architettura-dei-componenti-e-strategia-di-testing">Architettura
        dei Componenti e Strategia di Testing</a></li>
        <li><a href="#unit-test" id="toc-unit-test">Unit Test</a></li>
        <li><a href="#sec:integration_test"
        id="toc-sec:integration_test">Integration Test</a></li>
        <li><a href="#sec:component_test"
        id="toc-sec:component_test">Component Test</a></li>
        <li><a href="#sec:async_test" id="toc-sec:async_test">Testing
        Asincrono</a></li>
        <li><a href="#livelli-superiori-della-piramide"
        id="toc-livelli-superiori-della-piramide">Livelli Superiori
        della Piramide</a></li>
        </ul></li>
        <li><a href="#ch:production_ready"
        id="toc-ch:production_ready">Micro-servizi production
        ready(Assignement 7)</a>
        <ul>
        <li><a href="#sicurezza" id="toc-sicurezza">Sicurezza</a></li>
        <li><a href="#configurabilità"
        id="toc-configurabilità">Configurabilità</a></li>
        <li><a href="#osservabilità"
        id="toc-osservabilità">Osservabilità</a>
        <ul>
        <li><a href="#health-check-api" id="toc-health-check-api">Health
        check API</a></li>
        <li><a href="#log-aggregation" id="toc-log-aggregation">Log
        aggregation</a></li>
        <li><a href="#log-tracing" id="toc-log-tracing">Log
        Tracing</a></li>
        <li><a href="#tracing-servizi" id="toc-tracing-servizi">Tracing
        servizi</a></li>
        </ul></li>
        </ul></li>
        </ul>

        </div>
      </div>
            <div class="span9">

      
      <div class="titlepage">
<div class="center">
<p><span>UNIBO<br />
Department of Computer Science</span><br />
</p>
<p>Relazione progetto MaraffaOnline - SAP</p>
<p> <br />
<span> Matteo Santoro </span><br />
<span> <em>Supervisor:</em> Alessandro ricci</span><br />
</p>
<p>2026-02-17</p>
</div>
</div>
<h1 class="unnumbered" id="declaration">Declaration</h1>
<p>I, Matteo Santoro, del Dipartimento di Informatica dell’Università di
Bologna, confermo che il presente lavoro è di mia proprietà e che le
figure, le tabelle, le equazioni, i frammenti di codice, le opere d’arte
e le illustrazioni contenute in questa relazione sono originali e non
sono state tratte da lavori di altre persone, tranne nei casi in cui i
lavori di altri sono stati esplicitamente riconosciuti, citati e
referenziati. Sono consapevole che, in caso contrario, si configurerà un
caso di plagio. Il plagio è una forma di cattiva condotta accademica e
sarà sanzionato di conseguenza.<br />
 <br />
</p>
<div class="flushright">
<p>Matteo Santoro</p>
<p>2026-02-17</p>
</div>
<h2 id="list-of-abbreviations">List of Abbreviations</h2>
<div class="abbrv">
<p>School of Mathematical, Physical and Computational Sciences</p>
</div>
<h1 id="ch:into">Introduction</h1>
<p>MaraffaOnline è un’applicazione che permette alle persone di giocare
al gioco di carte <a
href="https://it.wikipedia.org/wiki/Marafone_Beccacino">Maraffa/Beccacino</a>.
Il progetto consiste nell’eseguire una manutenzione evolutiva del gioco
di carte reperibile su MaraffaOnline, attualmente sviluppato dalla
prof.ssa Lumini. In particolare la nuova versione avrà un’architettura a
microservizi e introdurrà anche nuove funzionalità come formazione
personalizzata delle squadre, una nuova modalità di gioco (vittoria 11 a
0 in caso di violazione delle regole da parte di una squadra),
salvataggio delle statistiche delle partite e degli utenti, ...<br />
Per lo sviluppo è stato seguito un approccio Domain Driven Design, per
il quale si è approfondito il dominio del gioco.<br />
È stata posta particolare attenzione alle tecniche di continuos
integration, alle quali è stato dedicato uno dei capitoli di questo
report.</p>
<h1 id="ch:decomposition">Decomposizione da monolite a micro-servizi
(Assignment 5)</h1>
<h2 id="introduzione-e-contesto">Introduzione e contesto</h2>
<p>La precedente versione del software era funzionante ma difficile da
mantenere ed aggiornare, data la struttura monolitica. Esisteva un unico
sorgente che conteneva al suo interno logiche di business, nessun tipo
di persistenza e la view tutti insieme.</p>
<p>Il progetto consiste in una manutenzione evolutiva del gioco di carte
MaraffaOnline, che introduce diverse novità rispetto alla versione
precedente:</p>
<ul>
<li><p>Architettura a microservizi con almeno due tecnologie
differenti</p></li>
<li><p>Formazione personalizzata delle squadre</p></li>
<li><p>Nuova modalità di gioco (vittoria 11 a 0 in caso di violazione
regole)</p></li>
<li><p>Salvataggio statistiche partite e utenti</p></li>
<li><p>Sistema di chat integrato (globale e di partita)</p></li>
</ul>
<p>Per poter decomporre questo monolite sono state eseguite le fasi
di:</p>
<ul>
<li><p>Identificazione delle operazioni di sistema</p></li>
<li><p>Decomposizione in servizi, in subdomain seguendo i principi del
Domain-Driven Design (DDD)</p></li>
<li><p>Identificazione di API di comunicazione tra servizi</p></li>
<li><p>Applicazione di pattern architetturali per microservizi</p></li>
</ul>
<h2 id="operazioni-di-sistema">Operazioni di sistema</h2>
<h3
id="knowledge-crunching-session-for-the-exploration-of-the-problem-space">Knowledge
crunching session for the exploration of the problem space</h3>
<p>È stato utilizzato il metodo Event Storming per l’esplorazione del
dominio. La tecnica consiste nell’individuare degli eventi di dominio e
riportarli al passato su un post-it arancione. Una volta individuati gli
eventi, sono stati scritti su post-it blu i comandi che l’utente svolge
per creare l’evento. In giallo è stato specificato l’attore, la persona
che esegue il comando, mentre in verde la view, l’interfaccia software
con la quale l’utente interagisce. Infine, con delle label si sono
aggregati i post-it in unità di dominio. Si riporta di seguito lo screen
della lavagna con i post-it e la relativa legenda.</p>
<figure id="event_storming">
<p><img src="report/img/EventStorming.png" alt="image" /><br />
</p>
<figcaption>Event Storming</figcaption>
</figure>
<figure id="legend">
<img src="report/img/event_storming_legend.png" />
<figcaption>Event Storming Legend</figcaption>
</figure>
<ol>
<li><p>Account</p>
<ol>
<li><p>Login</p></li>
<li><p>Registrazione</p></li>
<li><p>Recupero password</p></li>
<li><p>Visualizzazione profilo</p></li>
<li><p>Modifica password</p></li>
<li><p>Possibilità di scegliere se giocare come ospite o effettuare il
login</p></li>
</ol></li>
<li><p>Realizzazione partita</p>
<ol>
<li><p>Creazione partita</p></li>
<li><p>Partecipazione partita</p></li>
<li><p>Gioca carta</p></li>
<li><p>Inizio partita</p></li>
<li><p>Fine mano</p></li>
<li><p>Fine partita</p></li>
</ol></li>
<li><p>Chat di gioco</p>
<ol>
<li><p>Chat globale</p></li>
<li><p>Chat partita</p></li>
</ol></li>
<li><p>Possibilità di scegliere un compagno di squadra</p></li>
<li><p>Scelta del seme, parole consentite</p></li>
<li><p>Modalità di gioco 11 a 0</p></li>
<li><p>Gestione punteggio</p>
<ol>
<li><p>Calcolo totale e parziale (Gestione per ogni mano) del
punteggio</p></li>
<li><p>Maraffa/Cricca (+3 punti)</p></li>
</ol></li>
<li><p>Servizio gestione utenti</p></li>
<li><p>Salvataggio statistiche</p></li>
<li><p>Realizzazione GUI</p>
<ol>
<li><p>Refactor della GUI esistente</p></li>
<li><p>Rinnovamento GUI</p></li>
</ol></li>
</ol>
<h3 id="casi-duso">Casi d’uso</h3>
<p>Si riporta di seguito lo schema dei casi d’uso che modella
l’interazione dell’utente con l’applicazione.</p>
<figure id="use_case">
<img src="report/img/Casi_duso.png" />
<figcaption>Schema dei casi d’uso</figcaption>
</figure>
<h2 id="decomposizione-in-servizi">Decomposizione in servizi</h2>
<h3 id="strategia-decompose-by-subdomain-ddd">Strategia: Decompose by
Subdomain (DDD)</h3>
<p>La decomposizione è stata guidata dall’identificazione dei
<strong>bounded contexts</strong> secondo i principi del Domain-Driven
Design. Questo approccio permette di:</p>
<ul>
<li><p>Definire confini chiari tra i servizi</p></li>
<li><p>Minimizzare le dipendenze tra microservizi</p></li>
<li><p>Allineare l’architettura software al dominio di business</p></li>
</ul>
<h3 id="bounded-context">Bounded Context</h3>
<p>Analizzando il dominio di MaraffaOnline, sono stati identificati i
tre principali bounded context che andranno poi a definire (ad alto
livello) i servizi e alcune delle loro API all’interno
dell’architettura.</p>
<p>Nella figura si può osservare un primo bounded context, colorato di
azzurro, che modella l’autenticazione dell’utente (<strong>User
Context</strong>):</p>
<ul>
<li><p><strong>User:</strong> persona che possiede l’account</p></li>
<li><p><strong>Statistic:</strong> dati dell’utente relativi al gioco
come numero di vittorie, sconfitte, partite giocate e maraffe</p></li>
<li><p><strong>Authentication:</strong> accesso all’applicativo
MaraffaOnline da parte dell’utente</p></li>
</ul>
<p>Il secondo bounded context, colorato di verde, modella la partita
(<strong>Game Context</strong>):</p>
<ul>
<li><p><strong>Game:</strong> partita</p></li>
<li><p><strong>Team:</strong> squadra composta da numero di giocatori /
2</p></li>
<li><p><strong>Score:</strong> punteggio delle due squadre</p></li>
<li><p><strong>Statistic:</strong> dati relativi ai game
giocati</p></li>
<li><p><strong>Trick:</strong> presa di quattro carte da parte di un
giocatore</p></li>
<li><p><strong>Round:</strong> 10 prese</p></li>
<li><p><strong>Card:</strong> carta</p></li>
<li><p><strong>Player:</strong> giocatore</p></li>
<li><p><strong>Deck:</strong> mazzo</p></li>
<li><p><strong>Hand:</strong> carte che ha in mano un giocatore</p></li>
</ul>
<p>Infine l’ultimo, di colore arancione, modella la chat
(<strong>Session Context</strong>):</p>
<ul>
<li><p><strong>Chat:</strong> chat di gioco</p></li>
<li><p><strong>Message:</strong> messaggio inviato nella chat</p></li>
<li><p><strong>User:</strong> persona che invia il messaggio</p></li>
</ul>
<p>È importante notare che il concetto di user/player è polisemico: vi
sono tre rappresentazioni diverse per afferire allo stesso concetto.</p>
<figure id="bounded_context">
<img src="report/img/BoundedCTX.png" />
<figcaption>Context Map</figcaption>
</figure>
<h3 id="architettura-dei-microservizi">Architettura dei
microservizi</h3>
<p>La decomposizione ha portato all’identificazione di tre microservizi
principali, ciascuno con responsabilità ben definite:</p>
<h4 id="userservice">UserService</h4>
<p>Questo servizio gestisce gli utenti, la loro registrazione,
autenticazione e gestione dei dati personali. È stato implementato
utilizzando:</p>
<ul>
<li><p><strong>Linguaggio:</strong> TypeScript</p></li>
<li><p><strong>Framework:</strong> NestJS</p></li>
<li><p><strong>Database:</strong> MySQL con TypeORM</p></li>
<li><p><strong>Architettura:</strong> Model-Controller-Service</p></li>
</ul>
<p>Il middleware delega al servizio di gestione degli utenti le
operazioni riguardanti gli utenti, per mantenere il middleware il più
leggero possibile. Il database contiene anche le informazioni
riguardanti le partite giocate e le statistiche personali di ogni
utente.</p>
<p>Le principali responsabilità includono:</p>
<ul>
<li><p>Registrazione e autenticazione tramite JWT</p></li>
<li><p>Gestione dei profili utente</p></li>
<li><p>Calcolo e memorizzazione delle statistiche di gioco</p></li>
</ul>
<h4 id="businesslogic">BusinessLogic</h4>
<p>Questo servizio mantiene al proprio interno tutte le regole del gioco
e il calcolo dei punteggi. Ha svariati endpoint che permettono al
middleware di delegare le operazioni riguardanti il gioco. Questa scelta
permette in futuro di aggiungere nuovi giochi modificando il meno
possibile il middleware.</p>
<p>Implementato con lo stesso stack del UserService (NestJS e
TypeScript), è completamente <strong>stateless</strong> e si occupa
esclusivamente di:</p>
<ul>
<li><p>Validazione delle mosse secondo le regole della Maraffa</p></li>
<li><p>Calcolo dei punteggi</p></li>
<li><p>Verifica della correttezza delle giocate</p></li>
</ul>
<h4 id="middleware-api-gateway-game-engine">Middleware (API Gateway +
Game Engine)</h4>
<p>Il middleware è il cuore del sistema e svolge molteplici ruoli. È
stato implementato in Java utilizzando il framework Vert.x, scelto per
le sue caratteristiche event-driven e reactive, particolarmente adatte
alla gestione di connessioni concorrenti.</p>
<p>L’architettura utilizzata per la gestione delle partite è quella di
un <strong>multi-attore</strong>, in cui ogni attore si occupa di
gestire una partita e di orchestrare la comunicazione con gli altri
servizi.</p>
<p>Al middleware è collegato un database NoSQL su MongoDB, che viene
aggiornato a ogni trick completato dai giocatori per creare uno storico
delle partite e salvare le loro decisioni in gioco.</p>
<p>Le principali funzionalità includono:</p>
<ul>
<li><p>Routing delle richieste ai microservizi corretti</p></li>
<li><p>Validazione dei token JWT</p></li>
<li><p>Orchestrazione della logica di gioco</p></li>
<li><p>Gestione delle connessioni WebSocket</p></li>
<li><p>Coordinamento delle chat (globale e di partita)</p></li>
</ul>
<h4 id="frontend">Frontend</h4>
<p>Il frontend è stato sviluppato in TypeScript utilizzando Angular e
viene servito tramite Nginx. Quest’ultimo svolge anche il ruolo di
reverse proxy per mascherare le chiamate al backend e superare eventuali
problemi di CORS. La comunicazione con il middleware avviene tramite API
REST e WebSocket per gli aspetti real-time.</p>
<h3 id="schema-architettura">Schema architettura</h3>
<p><img src="report/img/Architecture.png" style="width:16cm"
alt="image" /><br />
</p>
<h2 id="pattern-architetturali-applicati">Pattern architetturali
applicati</h2>
<h3 id="api-gateway-pattern">API Gateway Pattern</h3>
<p>Il Middleware implementa il pattern API Gateway, fungendo da unico
punto di ingresso per tutti i client. Questo approccio centralizza
diverse funzionalità critiche:</p>
<ul>
<li><p><strong>Routing:</strong> smista le richieste ai microservizi
corretti</p></li>
<li><p><strong>Authentication:</strong> valida i token JWT prima di
inoltrare le richieste</p></li>
<li><p><strong>Game Orchestration:</strong> coordina la logica di gioco
tra i servizi</p></li>
<li><p><strong>WebSocket Management:</strong> gestisce le connessioni
real-time per gioco e chat</p></li>
</ul>
<p>Si è seguito un approccio modulare nello sviluppo di questo
componente che, in un primo step, conteneva soltanto la logica di
gestione delle partite, al quale sono stati aggiunti i moduli per la
comunicazione con il servizio degli utenti e della business logic. Ogni
modulo segue la stessa struttura, ossia una classe denominata controller
che si occupa esclusivamente della dichiarazione delle rotte HTTP e che
a sua volta contiene un service. Ogni servizio contiene poi le logiche
di calcolo e crea un JSON di risposta che viene passato al controller
che lo invia come risposta HTTP, questo per poter separare completamente
e rispettare il principio di single responsibility.</p>
<p>Nel modulo contenente le logiche di gioco è stato necessario
aggiungere un ulteriore strato di separazione alla struttura
controller-service, data la struttura multi-attore della gestione delle
partite che non permetteva una separazione netta. Quindi è stato
aggiunto, tra il controller e il service, un componente ibrido per poter
comunque avere servizi indipendenti.</p>
<p>Questa separazione, oltre a essere una buona pratica, è stata scelta
per poter effettuare del testing comodamente soltanto sui servizi,
testando quindi solamente la parte relativa all’elaborazione di una
risposta.</p>
<h3 id="database-per-service-pattern">Database per Service Pattern</h3>
<p>È stato applicato parzialmente il pattern "Database per Service" per
garantire il disaccoppiamento dei dati:</p>
<ul>
<li><p><strong>UserService:</strong> utilizza MySQL per dati relazionali
strutturati (utenti, credenziali, statistiche)</p></li>
<li><p><strong>Middleware:</strong> utilizza MongoDB per lo storico
delle partite e dati flessibili</p></li>
<li><p><strong>BusinessLogic:</strong> servizio completamente stateless,
non necessita di database</p></li>
</ul>
<p>Ogni microservizio gestisce i propri dati in modo indipendente,
evitando dipendenze dirette sui database di altri servizi.</p>
<h2 id="comunicazione-tra-servizi">Comunicazione tra servizi</h2>
<h3 id="api-gateway">API Gateway</h3>
<p>Sono state implementate diverse forme di comunicazione tra servizi in
base alle caratteristiche del messaggio che viene scambiato. Si è scelto
di utilizzare la comunicazione REST nella maggior parte dei servizi,
vista la sua interoperabilità.</p>
<p>Non è stato necessario implementare un vero e proprio broker di
messaggi, ma è stato implementato un servizio denominato middleware che
svolge il ruolo di API gateway delle richieste dai client verso il
sistema.</p>
<p>Queste chiamate non sono obbligatoriamente dirette verso il servizio
interessato, ma possono anche essere routine che effettuano molteplici
chiamate per ottenere il risultato desiderato. Implementare queste
chiamate direttamente nel front-end avrebbe reso il codice molto più
complesso e difficile da mantenere, e la gestione di partite multiple
sarebbe stata molto più complicata.</p>
<p>Non è stato implementato nessun meccanismo di discovery per scoprire
l’indirizzo degli altri servizi, è stata sfruttata la tecnologia
built-in di docker che permette di poter utilizzare degli alias e
nascondere al proprio interno i meccanismi di registration, questo
comunque implica che tutto debba essere sempre mantenuto nell’ambiente
virtualizzato e quindi ogni futuro servizio containerizzato.</p>
<h3 id="websocket-per-comunicazione-real-time">WebSocket per
comunicazione Real-Time</h3>
<p>L’interazione con il frontend avviene prevalentemente tramite il
protocollo HTTP, ma per la gestione di alcuni aspetti in tempo reale
sono state introdotte le WebSocket.</p>
<h4 id="dashboard-reattiva">Dashboard reattiva</h4>
<p>In una prima implementazione era stato utilizzato un polling per
aggiornare i dati delle partite. Tramite WebSocket, è direttamente il
middleware che notifica tutti i client della creazione di una nuova
partita via broadcast, migliorando significativamente la reattività
dell’interfaccia.</p>
<h4 id="chat-globale-e-privata">Chat globale e privata</h4>
<p>Questo componente è stato creato per la gestione delle chat di gioco,
in modo che i giocatori possano comunicare tra loro in tempo reale. Il
sistema implementa due tipologie di chat:</p>
<ul>
<li><p><strong>Chat globale:</strong> accessibile a tutti gli utenti
connessi</p></li>
<li><p><strong>Chat di partita:</strong> accessibile solo ai giocatori
della partita in corso</p></li>
</ul>
<p>Ogni client, istanziato sul computer degli utenti, effettua una
connessione WebSocket con il middleware utilizzando come endpoint il
proprio UUID, che viene assegnato automaticamente all’avvio, e lo
username del giocatore, dopo aver effettuato il login. Il middleware
contiene al proprio interno una mappa di tutti i client e giocatori
connessi con la relativa WebSocket e una classe che espone due metodi
per inviare messaggi a un singolo giocatore o effettuare un messaggio
broadcast a tutti i giocatori connessi.</p>
<p>Il middleware si occupa di instradare i messaggi alle giuste chat,
garantendo la privacy delle conversazioni di partita.</p>
<h4 id="eventi-di-gioco">Eventi di gioco</h4>
<p>Il modulo di game si occupa di gestire le partite, quindi è l’unico
che può sapere quali giocatori devono ricevere determinati messaggi
relativi a una singola partita. Per utilizzare il servizio di WebSocket,
è stata implementata una semplice interfaccia all’interno dell’attore di
gioco con la quale si effettuano chiamate "onEvent". Ogni volta che un
particolare evento si verifica, un’invocazione a queste chiamate
permette di inviare messaggi alle WebSocket dei giocatori
interessati.</p>
<p>L’interfaccia definisce i principali eventi del ciclo di vita di una
partita:</p>
<pre><code>public interface IGameActor {
    void onCreateGame(User user);
    void onNewRound();
    void onJoinGame(User user);
    void onStartGame();
    void onPlayCard();
    void onTrickCompleted(Trick latestTrick);
    void onEndRound();
    void onEndGame();
    // ... altri eventi
}</code></pre>
<h2 id="deployment-e-devops">Deployment e DevOps</h2>
<h3 id="containerizzazione">Containerizzazione</h3>
<p>Ogni servizio è stato dockerizzato utilizzando <strong>multi-stage
builds</strong> per ottenere immagini leggere e ottimizzate. Questa
tecnica permette di separare la fase di build dalla fase di esecuzione,
includendo nell’immagine finale solo i file strettamente necessari.</p>
<p>Per i servizi Node.js (UserService e BusinessLogic), il primo stage
utilizza un’immagine completa per la compilazione, mentre il secondo
stage copia solo i file compilati e le dipendenze di produzione.</p>
<p>Il middleware Java utilizza un’immagine Gradle per la build e OpenJDK
per l’esecuzione, producendo un Fat JAR che include tutte le dipendenze
necessarie.</p>
<p>Il frontend Angular viene compilato in un primo stage e poi servito
tramite Nginx, che gestisce anche il reverse proxy verso i servizi
backend.</p>
<h3 id="stack-docker-e-reti">Stack Docker e reti</h3>
<p>Il sistema utilizza reti Docker interne per la comunicazione tra
container, con IP privati assegnati automaticamente. I servizi non sono
esposti direttamente all’esterno, creando un’architettura più sicura.
Gli indirizzi sono configurati tramite variabili d’ambiente, facilitando
la gestione di diversi ambienti di deployment.</p>
<h3 id="struttura-repository">Struttura repository</h3>
<p>Il progetto utilizza <strong>repository separate</strong> per ogni
microservizio, collegate tramite git submodules. Questa scelta
garantisce:</p>
<ul>
<li><p>Indipendenza nello sviluppo di ogni componente</p></li>
<li><p>Possibilità di utilizzare workflow CI/CD specifici per ogni
servizio</p></li>
<li><p>Versionamento indipendente dei servizi</p></li>
</ul>
<p>La repository principale contiene i file docker-compose per
l’orchestrazione dei container e i submodules che puntano alle singole
repository dei servizi.</p>
<h3 id="continuous-integration">Continuous Integration</h3>
<p>Ogni repository ha workflow automatizzati tramite GitHub Actions che
includono:</p>
<ul>
<li><p><strong>Build:</strong> compilazione del codice</p></li>
<li><p><strong>Test:</strong> esecuzione dei test automatici</p></li>
<li><p><strong>Deploy:</strong> build e push dell’immagine
Docker</p></li>
</ul>
<p>I workflow vengono attivati su pull request verso il branch develop e
su release manuali sul branch main. Il progetto adotta
<strong>Conventional Commits</strong> per standardizzare i messaggi di
commit e facilitare la generazione automatica di changelog.</p>
<h3 id="monitoraggio">Monitoraggio</h3>
<p>È stato implementato uno stack completo di monitoraggio basato
su:</p>
<ul>
<li><p><strong>cAdvisor:</strong> raccolta metriche dei container (CPU,
memoria, rete, disco)</p></li>
<li><p><strong>Prometheus:</strong> storage delle metriche time-series e
sistema di alerting</p></li>
<li><p><strong>Grafana:</strong> dashboard per la visualizzazione e
analisi delle performance</p></li>
</ul>
<p>Questo sistema permette di monitorare in tempo reale lo stato di
salute dei servizi e identificare eventuali colli di bottiglia o
anomalie.</p>
<h2 id="documentazione-e-testing">Documentazione e testing</h2>
<h3 id="swagger-openapi">Swagger / OpenAPI</h3>
<p>Per la documentazione delle API è stato utilizzato Swagger, che
genera automaticamente la documentazione interattiva:</p>
<ul>
<li><p>Per i servizi Node.js: libreria che genera documentazione tramite
decoratori</p></li>
<li><p>Per i servizi Java: documentazione generata tramite
annotazioni</p></li>
</ul>
<h3 id="postman-e-testing">Postman e testing</h3>
<p>È stato utilizzato Postman per il testing delle API, con:</p>
<ul>
<li><p>Collection di richieste esportate da Swagger</p></li>
<li><p>Payload parametrizzati con variabili d’ambiente</p></li>
<li><p><strong>Flows:</strong> diagrammi di flusso delle richieste per
simulare partite complete end-to-end</p></li>
</ul>
<h3 id="sistema-di-logging">Sistema di Logging</h3>
<p>Il middleware implementa un sistema di log automatici tramite LogBack
che permette:</p>
<ul>
<li><p>Log su file per analisi in caso di problemi</p></li>
<li><p>Configurazione XML per personalizzazione (package, livelli, log
rotate)</p></li>
<li><p>Compressione automatica dei log oltre una certa
dimensione</p></li>
</ul>
<h2 id="vantaggi-e-sfide">Vantaggi e sfide</h2>
<h3 id="vantaggi-dellarchitettura">Vantaggi dell’architettura</h3>
<h4 id="fault-tolerance">Fault Tolerance</h4>
<p>La scelta dell’architettura a microservizi permette di
<strong>isolare parti del sistema</strong>, evitando che gli errori si
propaghino. Ogni servizio opera in modo indipendente con le proprie
risorse. Tuttavia, il middleware rappresenta un Single Point of Failure
che potrebbe essere mitigato implementando backup dei processi di
gestione partite o ridondanza con istanze multiple.</p>
<h4 id="scalabilità">Scalabilità</h4>
<p>Ogni microservizio può scalare in modo indipendente in base al
carico. Utilizzando orchestratori come Kubernetes è possibile bilanciare
il carico tra nodi e scalare orizzontalmente aggiungendo repliche dei
servizi sotto maggior stress.</p>
<h4 id="indipendenza-tecnologica">Indipendenza tecnologica</h4>
<p>L’utilizzo di due stack tecnologici differenti (Java/Vert.x per il
middleware e NestJS per gli altri servizi) dimostra la flessibilità
dell’architettura e permette di scegliere la tecnologia più adatta per
ogni componente.</p>
<h3 id="sfide-incontrate">Sfide incontrate</h3>
<p>Durante lo sviluppo sono emerse alcune criticità:</p>
<ul>
<li><p>Complessità nella gestione della comunicazione tra
servizi</p></li>
<li><p>Necessità di coordinamento per la definizione delle interfacce
API</p></li>
<li><p>Overhead di deployment con tecnologie multiple</p></li>
<li><p>Il middleware come single point of failure richiede attenzione
particolare</p></li>
</ul>
<h2 id="conclusioni">Conclusioni</h2>
<p>La decomposizione del monolite MaraffaOnline in un’architettura a
microservizi ha permesso di ottenere significativi vantaggi in termini
di manutenibilità, scalabilità e fault isolation.</p>
<p>I pattern applicati con successo includono:</p>
<ul>
<li><p><strong>API Gateway</strong> per centralizzare l’accesso ai
servizi</p></li>
<li><p><strong>Database per Service</strong> per il disaccoppiamento dei
dati</p></li>
<li><p><strong>Decompose by Subdomain</strong> per definire confini
chiari seguendo DDD</p></li>
<li><p><strong>WebSocket</strong> per la comunicazione
real-time</p></li>
</ul>
<p>Il sistema risultante è facilmente deployabile tramite Docker,
monitorabile attraverso strumenti standard (Prometheus/Grafana) e pronto
per essere scalato in base alle necessità. La separazione in
microservizi indipendenti facilita inoltre la manutenzione evolutiva e
l’aggiunta di nuove funzionalità senza impattare l’intero sistema.</p>
<h1 id="chap:QA">Quality Attributes</h1>
<p>In questa sezione vengono analizzati gli attributi di qualità
(<em>quality attributes</em>) rilevanti per l’architettura del sistema
sviluppato. Si tratta di requisiti non funzionali che influenzano
profondamente le decisioni progettuali e architetturali.</p>
<h2 id="operational">Operational</h2>
<ul>
<li><p>Robustezza: l’interfaccia limita abbastana le operazione che
possono esserer effettuate, rendendo il sistema più robusto.</p></li>
<li><p>Availability/Scalabilità: il sistema è progettato per essere
sempre disponibile, la replica di servizi mirati sul nodo swarm
garantisce che il sistema possa continuare a funzionare anche in caso di
guasti e bilanciarsi.</p></li>
<li><p>Usabilità: l’interfaccia è progettata per essere intuitiva e
facile da usare, con un design che facilita l’interazione dell’utente.
Non è stato previsto nel progetto la creazione di un tutorial o di una
guida, ma si è cercato di rendere l’interfaccia il più semplice
possibile. (Conoscere le regole del gioco di carte è stato considerato
sufficiente per l’utilizzo del sistema).</p></li>
</ul>
<h2 id="structural">Structural</h2>
<ul>
<li><p>Evolvabilità: il sistema è progettato per essere facilmente
estendibile e modificabile, con un’architettura modulare che consente
l’aggiunta di nuove funzionalità senza impattare le parti
esistenti.</p></li>
<li><p>Portabilità: il sistema è progettato per essere facilmente
distribuito su diverse piattaforme e ambienti, grazie all’uso di
tecnologie containerizzate come Docker..</p></li>
</ul>
<h1 id="ch:testing">Testing</h1>
<p>Per ogni servizio del sistema è stato adottato, ove possibile, il
paradigma di programmazione TDD (Test Driven Development). Questo
approccio prevede che i test vengano scritti prima del codice, in modo
da guidarne lo sviluppo e garantire che il software prodotto soddisfi i
requisiti specificati.</p>
<p>La strategia di testing adottata si ispira alla <strong>test
pyramid</strong> descritta in <span class="citation"
data-cites="richardson2019"></span>, che prevede una distribuzione dei
test su livelli crescenti di granularità: molti <em>unit test</em> alla
base, un numero inferiore di <em>integration test</em>, e pochi test ai
livelli superiori.</p>
<h2 id="strumenti-di-testing">Strumenti di Testing</h2>
<p>Le operazioni di testing sono state implementate con
<strong>Jest</strong> per quanto riguarda i servizi basati su Node.js,
generando report chiari e di facile lettura. Il componente middleware,
scritto in Java, produceva invece risultati di test meno comprensibili.
Per risolvere questo problema è stata introdotta, nel file di build
Gradle, la libreria <a
href="https://plugins.gradle.org/plugin/com.adarshr.test-logger"><u>Test
Logger</u></a>, tramite la seguente configurazione:</p>
<div class="sourceCode" id="list:gradle_testlogger" data-language="Java"
data-caption="Configurazione del Test Logger"
data-label="list:gradle_testlogger"><pre
class="sourceCode java"><code class="sourceCode java"><span id="list:gradle_testlogger-1"><a href="#list:gradle_testlogger-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">com</span><span class="op">.</span><span class="im">adarshr</span><span class="op">.</span><span class="im">gradle</span><span class="op">.</span><span class="im">testlogger</span><span class="op">.</span><span class="im">TestLoggerExtension</span></span>
<span id="list:gradle_testlogger-2"><a href="#list:gradle_testlogger-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">com</span><span class="op">.</span><span class="im">adarshr</span><span class="op">.</span><span class="im">gradle</span><span class="op">.</span><span class="im">testlogger</span><span class="op">.</span><span class="im">TestLoggerPlugin</span></span>
<span id="list:gradle_testlogger-3"><a href="#list:gradle_testlogger-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">com</span><span class="op">.</span><span class="im">adarshr</span><span class="op">.</span><span class="im">gradle</span><span class="op">.</span><span class="im">testlogger</span><span class="op">.</span><span class="im">theme</span><span class="op">.</span><span class="im">ThemeType</span></span>
<span id="list:gradle_testlogger-4"><a href="#list:gradle_testlogger-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:gradle_testlogger-5"><a href="#list:gradle_testlogger-5" aria-hidden="true" tabindex="-1"></a>testlogger <span class="op">{</span></span>
<span id="list:gradle_testlogger-6"><a href="#list:gradle_testlogger-6" aria-hidden="true" tabindex="-1"></a>    theme <span class="op">=</span> ThemeType<span class="op">.</span><span class="fu">MOCHA</span></span>
<span id="list:gradle_testlogger-7"><a href="#list:gradle_testlogger-7" aria-hidden="true" tabindex="-1"></a>    showExceptions <span class="op">=</span> <span class="kw">true</span></span>
<span id="list:gradle_testlogger-8"><a href="#list:gradle_testlogger-8" aria-hidden="true" tabindex="-1"></a>    showStackTraces <span class="op">=</span> <span class="kw">true</span></span>
<span id="list:gradle_testlogger-9"><a href="#list:gradle_testlogger-9" aria-hidden="true" tabindex="-1"></a>    showFullStackTraces <span class="op">=</span> <span class="kw">false</span></span>
<span id="list:gradle_testlogger-10"><a href="#list:gradle_testlogger-10" aria-hidden="true" tabindex="-1"></a>    showCauses <span class="op">=</span> <span class="kw">true</span></span>
<span id="list:gradle_testlogger-11"><a href="#list:gradle_testlogger-11" aria-hidden="true" tabindex="-1"></a>    slowThreshold <span class="op">=</span> <span class="dv">2000</span></span>
<span id="list:gradle_testlogger-12"><a href="#list:gradle_testlogger-12" aria-hidden="true" tabindex="-1"></a>    showSummary <span class="op">=</span> <span class="kw">true</span></span>
<span id="list:gradle_testlogger-13"><a href="#list:gradle_testlogger-13" aria-hidden="true" tabindex="-1"></a>    showSimpleNames <span class="op">=</span> <span class="kw">false</span></span>
<span id="list:gradle_testlogger-14"><a href="#list:gradle_testlogger-14" aria-hidden="true" tabindex="-1"></a>    showPassed <span class="op">=</span> <span class="kw">true</span></span>
<span id="list:gradle_testlogger-15"><a href="#list:gradle_testlogger-15" aria-hidden="true" tabindex="-1"></a>    showSkipped <span class="op">=</span> <span class="kw">true</span></span>
<span id="list:gradle_testlogger-16"><a href="#list:gradle_testlogger-16" aria-hidden="true" tabindex="-1"></a>    showFailed <span class="op">=</span> <span class="kw">true</span></span>
<span id="list:gradle_testlogger-17"><a href="#list:gradle_testlogger-17" aria-hidden="true" tabindex="-1"></a>    showOnlySlow <span class="op">=</span> <span class="kw">false</span></span>
<span id="list:gradle_testlogger-18"><a href="#list:gradle_testlogger-18" aria-hidden="true" tabindex="-1"></a>    showStandardStreams <span class="op">=</span> <span class="kw">false</span></span>
<span id="list:gradle_testlogger-19"><a href="#list:gradle_testlogger-19" aria-hidden="true" tabindex="-1"></a>    showPassedStandardStreams <span class="op">=</span> <span class="kw">true</span></span>
<span id="list:gradle_testlogger-20"><a href="#list:gradle_testlogger-20" aria-hidden="true" tabindex="-1"></a>    showSkippedStandardStreams <span class="op">=</span> <span class="kw">true</span></span>
<span id="list:gradle_testlogger-21"><a href="#list:gradle_testlogger-21" aria-hidden="true" tabindex="-1"></a>    showFailedStandardStreams <span class="op">=</span> <span class="kw">true</span></span>
<span id="list:gradle_testlogger-22"><a href="#list:gradle_testlogger-22" aria-hidden="true" tabindex="-1"></a>    logLevel <span class="op">=</span> LogLevel<span class="op">.</span><span class="fu">LIFECYCLE</span></span>
<span id="list:gradle_testlogger-23"><a href="#list:gradle_testlogger-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="architettura-dei-componenti-e-strategia-di-testing">Architettura
dei Componenti e Strategia di Testing</h2>
<p>L’architettura interna di ciascun servizio segue una struttura a due
livelli:</p>
<ul>
<li><p><strong>Classi controller</strong>: espongono le rotte e delegano
alle classi di servizio.</p></li>
<li><p><strong>Classi di servizio</strong>: contengono la logica di
business.</p></li>
</ul>
<p>Questa separazione consente di applicare strategie di testing
differenziate per ciascun livello, coerentemente con quanto suggerito
dall’architettura esagonale <span class="citation"
data-cites="richardson2019"></span>: le classi di servizio vengono
testate con <em>solitary unit test</em> che ne verificano la logica in
isolamento, mentre le interazioni tra servizi e con l’infrastruttura
vengono verificate ai livelli superiori della piramide.</p>
<h2 id="unit-test">Unit Test</h2>
<p>Gli <em>unit test</em> costituiscono la base della test pyramid e
sono orientati alla tecnologia. Nel nostro sistema, sono stati
implementati come <strong>solitary unit test</strong> sulle classi di
servizio, verificando la correttezza della logica di business in
isolamento dalle dipendenze esterne.</p>
<p>Non sono stati realizzati unit test dedicati per le classi controller
dei singoli servizi. Secondo la strategia suggerita in <span
class="citation" data-cites="richardson2019"></span>, i controller
andrebbero testati con solitary unit test che mockano i servizi
sottostanti; nel nostro caso, si è scelto di verificarne il
comportamento ai livelli superiori della piramide, tramite i test
descritti nella Sezione <a href="#sec:component_test"
data-reference-type="ref" data-reference="sec:component_test">4.5</a>.
Si tratta di una limitazione consapevole, motivata dalla semplicità dei
controller che si limitano a delegare alle classi di servizio.</p>
<h2 id="sec:integration_test">Integration Test</h2>
<p>Gli <em>integration test</em> si collocano al livello immediatamente
superiore agli unit test nella piramide. Il loro scopo è verificare che
un servizio possa interagire correttamente con i servizi
infrastrutturali da cui dipende, in particolare i database <span
class="citation" data-cites="richardson2019"></span>.</p>
<p>Nel nostro sistema, ad eccezione del servizio contenente la business
logic — che non ha dipendenze verso database né verso altri servizi —
sono stati realizzati <strong>persistence integration test</strong> per
verificare il corretto collegamento tra i servizi e i rispettivi
database (MySQL e MongoDB).</p>
<p>L’esempio seguente mostra un persistence integration test che
verifica l’interazione tra il servizio di gioco e MongoDB:</p>
<div class="sourceCode" id="list:mongo_test" data-language="Java"
data-caption="Persistence integration test per MongoDB"
data-label="list:mongo_test"><pre class="sourceCode java"><code class="sourceCode java"><span id="list:mongo_test-1"><a href="#list:mongo_test-1" aria-hidden="true" tabindex="-1"></a><span class="at">@TestInstance</span><span class="op">(</span>Lifecycle<span class="op">.</span><span class="fu">PER_CLASS</span><span class="op">)</span></span>
<span id="list:mongo_test-2"><a href="#list:mongo_test-2" aria-hidden="true" tabindex="-1"></a><span class="at">@ExtendWith</span><span class="op">(</span>VertxExtension<span class="op">.</span><span class="fu">class</span><span class="op">)</span></span>
<span id="list:mongo_test-3"><a href="#list:mongo_test-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> StatisticMongoTest <span class="op">{</span></span>
<span id="list:mongo_test-4"><a href="#list:mongo_test-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> <span class="dt">int</span> TRICKS <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="list:mongo_test-5"><a href="#list:mongo_test-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">final</span> User userTest <span class="op">=</span> <span class="kw">new</span> <span class="fu">User</span><span class="op">(</span><span class="st">&quot;user&quot;</span><span class="op">,</span> <span class="bu">UUID</span><span class="op">.</span><span class="fu">randomUUID</span><span class="op">(),</span> <span class="kw">false</span><span class="op">);</span></span>
<span id="list:mongo_test-6"><a href="#list:mongo_test-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> <span class="dt">int</span> MARAFFA_PLAYERS <span class="op">=</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="list:mongo_test-7"><a href="#list:mongo_test-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> <span class="dt">int</span> EXPECTED_SCORE <span class="op">=</span> <span class="dv">11</span><span class="op">;</span></span>
<span id="list:mongo_test-8"><a href="#list:mongo_test-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> <span class="bu">String</span> PASSWORD <span class="op">=</span> <span class="st">&quot;1234&quot;</span><span class="op">;</span></span>
<span id="list:mongo_test-9"><a href="#list:mongo_test-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> GameMode GAME_MODE <span class="op">=</span> GameMode<span class="op">.</span><span class="fu">CLASSIC</span><span class="op">;</span></span>
<span id="list:mongo_test-10"><a href="#list:mongo_test-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> Vertx vertx<span class="op">;</span></span>
<span id="list:mongo_test-11"><a href="#list:mongo_test-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> GameService gameService<span class="op">;</span></span>
<span id="list:mongo_test-12"><a href="#list:mongo_test-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> CardSuit UNDEFINED_TRUMP <span class="op">=</span> CardSuit<span class="op">.</span><span class="fu">NONE</span><span class="op">;</span></span>
<span id="list:mongo_test-13"><a href="#list:mongo_test-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">final</span> Card<span class="op">&lt;</span>CardSuit<span class="op">,</span> CardValue<span class="op">&gt;</span> cardTest <span class="op">=</span> <span class="kw">new</span> Card<span class="op">&lt;&gt;(</span>CardValue<span class="op">.</span><span class="fu">THREE</span><span class="op">,</span> CardSuit<span class="op">.</span><span class="fu">CLUBS</span><span class="op">);</span></span>
<span id="list:mongo_test-14"><a href="#list:mongo_test-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">final</span> <span class="bu">Boolean</span> isSuitFinished <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="list:mongo_test-15"><a href="#list:mongo_test-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">final</span> MongoStatisticManager mongoStatisticManager <span class="op">=</span> <span class="kw">new</span> <span class="fu">MongoStatisticManager</span><span class="op">(</span></span>
<span id="list:mongo_test-16"><a href="#list:mongo_test-16" aria-hidden="true" tabindex="-1"></a>        Dotenv<span class="op">.</span><span class="fu">configure</span><span class="op">().</span><span class="fu">filename</span><span class="op">(</span><span class="st">&quot;env.example&quot;</span><span class="op">).</span><span class="fu">load</span><span class="op">().</span><span class="fu">get</span><span class="op">(</span><span class="st">&quot;MONGO_USER&quot;</span><span class="op">,</span> <span class="st">&quot;user&quot;</span><span class="op">),</span></span>
<span id="list:mongo_test-17"><a href="#list:mongo_test-17" aria-hidden="true" tabindex="-1"></a>        Dotenv<span class="op">.</span><span class="fu">configure</span><span class="op">().</span><span class="fu">filename</span><span class="op">(</span><span class="st">&quot;env.example&quot;</span><span class="op">).</span><span class="fu">load</span><span class="op">().</span><span class="fu">get</span><span class="op">(</span><span class="st">&quot;MONGO_PASSWORD&quot;</span><span class="op">,</span> <span class="st">&quot;password&quot;</span><span class="op">),</span></span>
<span id="list:mongo_test-18"><a href="#list:mongo_test-18" aria-hidden="true" tabindex="-1"></a>        Dotenv<span class="op">.</span><span class="fu">configure</span><span class="op">().</span><span class="fu">filename</span><span class="op">(</span><span class="st">&quot;env.example&quot;</span><span class="op">).</span><span class="fu">load</span><span class="op">().</span><span class="fu">get</span><span class="op">(</span><span class="st">&quot;MONGO_HOST&quot;</span><span class="op">,</span> <span class="st">&quot;localhost&quot;</span><span class="op">),</span></span>
<span id="list:mongo_test-19"><a href="#list:mongo_test-19" aria-hidden="true" tabindex="-1"></a>        <span class="bu">Integer</span><span class="op">.</span><span class="fu">parseInt</span><span class="op">(</span>Dotenv<span class="op">.</span><span class="fu">configure</span><span class="op">().</span><span class="fu">filename</span><span class="op">(</span><span class="st">&quot;env.example&quot;</span><span class="op">).</span><span class="fu">load</span><span class="op">().</span><span class="fu">get</span><span class="op">(</span><span class="st">&quot;MONGO_PORT&quot;</span><span class="op">,</span> <span class="st">&quot;27127&quot;</span><span class="op">)),</span></span>
<span id="list:mongo_test-20"><a href="#list:mongo_test-20" aria-hidden="true" tabindex="-1"></a>        Dotenv<span class="op">.</span><span class="fu">configure</span><span class="op">().</span><span class="fu">filename</span><span class="op">(</span><span class="st">&quot;env.example&quot;</span><span class="op">).</span><span class="fu">load</span><span class="op">().</span><span class="fu">get</span><span class="op">(</span><span class="st">&quot;MONGO_DATABASE&quot;</span><span class="op">,</span> <span class="st">&quot;maraffa-test&quot;</span><span class="op">)</span></span>
<span id="list:mongo_test-21"><a href="#list:mongo_test-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="list:mongo_test-22"><a href="#list:mongo_test-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:mongo_test-23"><a href="#list:mongo_test-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">@BeforeAll</span></span>
<span id="list:mongo_test-24"><a href="#list:mongo_test-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">setUp</span><span class="op">()</span> <span class="op">{</span></span>
<span id="list:mongo_test-25"><a href="#list:mongo_test-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">vertx</span> <span class="op">=</span> Vertx<span class="op">.</span><span class="fu">vertx</span><span class="op">();</span></span>
<span id="list:mongo_test-26"><a href="#list:mongo_test-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">gameService</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">GameService</span><span class="op">(</span><span class="kw">this</span><span class="op">.</span><span class="fu">vertx</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="fu">mongoStatisticManager</span><span class="op">);</span></span>
<span id="list:mongo_test-27"><a href="#list:mongo_test-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="list:mongo_test-28"><a href="#list:mongo_test-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:mongo_test-29"><a href="#list:mongo_test-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">@AfterAll</span></span>
<span id="list:mongo_test-30"><a href="#list:mongo_test-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">tearDown</span><span class="op">()</span> <span class="op">{</span></span>
<span id="list:mongo_test-31"><a href="#list:mongo_test-31" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">vertx</span><span class="op">.</span><span class="fu">close</span><span class="op">();</span></span>
<span id="list:mongo_test-32"><a href="#list:mongo_test-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="list:mongo_test-33"><a href="#list:mongo_test-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:mongo_test-34"><a href="#list:mongo_test-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Test</span></span>
<span id="list:mongo_test-35"><a href="#list:mongo_test-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">prepareGame</span><span class="op">()</span> <span class="op">{</span></span>
<span id="list:mongo_test-36"><a href="#list:mongo_test-36" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="bu">String</span> gameID <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">gameService</span></span>
<span id="list:mongo_test-37"><a href="#list:mongo_test-37" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">createGame</span><span class="op">(</span>MARAFFA_PLAYERS<span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="fu">userTest</span><span class="op">,</span> EXPECTED_SCORE<span class="op">,</span> GAME_MODE<span class="op">.</span><span class="fu">toString</span><span class="op">())</span></span>
<span id="list:mongo_test-38"><a href="#list:mongo_test-38" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">getString</span><span class="op">(</span>Constants<span class="op">.</span><span class="fu">GAME_ID</span><span class="op">);</span></span>
<span id="list:mongo_test-39"><a href="#list:mongo_test-39" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">var</span> doc <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">mongoStatisticManager</span><span class="op">.</span><span class="fu">getRecord</span><span class="op">(</span>gameID <span class="op">+</span> <span class="st">&quot;-0&quot;</span><span class="op">);</span></span>
<span id="list:mongo_test-40"><a href="#list:mongo_test-40" aria-hidden="true" tabindex="-1"></a>        <span class="fu">assertNotNull</span><span class="op">(</span>doc<span class="op">);</span></span>
<span id="list:mongo_test-41"><a href="#list:mongo_test-41" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="list:mongo_test-42"><a href="#list:mongo_test-42" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Il test segue le fasi canoniche: <strong>setup</strong>
(inizializzazione di Vert.x e del servizio con connessione a MongoDB),
<strong>execute</strong> (creazione di una partita e recupero del
record), <strong>verify</strong> (asserzione sulla presenza del
documento), <strong>teardown</strong> (chiusura di Vert.x).</p>
<h2 id="sec:component_test">Component Test</h2>
<p>I <em>component test</em> verificano il comportamento di un servizio
trattandolo come una <em>black box</em> e interagendo con esso
attraverso la sua API <span class="citation"
data-cites="richardson2019"></span>.</p>
<p>Nel nostro sistema, il componente middleware svolge il ruolo di API
Gateway e si occupa di mettere in comunicazione i servizi tra loro e con
il frontend. I test realizzati al suo interno verificano che le API
esposte dagli altri servizi rispondano correttamente e che i contenuti
vengano deserializzati nel formato atteso.</p>
<p>Questi test, pur non utilizzando un framework di contract testing
come Spring Cloud Contract o Pact, svolgono nella pratica un ruolo
analogo ai <strong>consumer-driven contract test</strong>: il middleware
agisce come <em>consumer</em> delle API degli altri servizi, e i test
verificano che il <em>provider</em> rispetti il contratto implicito
(endpoint corretto, struttura della response attesa, status code).</p>
<h2 id="sec:async_test">Testing Asincrono</h2>
<p>Durante la scrittura dei test del servizio Java, alcune operazioni
risultavano asincrone; è stato quindi necessario attendere il
completamento di tali operazioni prima di poter validare i test. La
struttura di test standard fornita da Vert.x non era sufficiente in un
primo momento. La forma classica dei test è la seguente:</p>
<div class="sourceCode" id="list:test_std_vertx" data-language="Java"
data-caption="Esempio di test sincrono con Vert.x"
data-label="list:test_std_vertx"><pre
class="sourceCode java"><code class="sourceCode java"><span id="list:test_std_vertx-1"><a href="#list:test_std_vertx-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Test</span></span>
<span id="list:test_std_vertx-2"><a href="#list:test_std_vertx-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">createGameTest</span><span class="op">(</span><span class="dt">final</span> VertxTestContext context<span class="op">)</span> <span class="op">{</span></span>
<span id="list:test_std_vertx-3"><a href="#list:test_std_vertx-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> JsonObject gameResponse <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">gameService</span><span class="op">.</span><span class="fu">createGame</span><span class="op">(</span></span>
<span id="list:test_std_vertx-4"><a href="#list:test_std_vertx-4" aria-hidden="true" tabindex="-1"></a>        MARAFFA_PLAYERS<span class="op">,</span> TEST_USER<span class="op">,</span> EXPECTED_SCORE<span class="op">,</span> GAME_MODE<span class="op">.</span><span class="fu">toString</span><span class="op">(),</span> PASSWORD<span class="op">);</span></span>
<span id="list:test_std_vertx-5"><a href="#list:test_std_vertx-5" aria-hidden="true" tabindex="-1"></a>    Assertions<span class="op">.</span><span class="fu">assertEquals</span><span class="op">(</span>UUID_SIZE<span class="op">,</span> gameResponse<span class="op">.</span><span class="fu">getString</span><span class="op">(</span>Constants<span class="op">.</span><span class="fu">GAME_ID</span><span class="op">).</span><span class="fu">length</span><span class="op">());</span></span>
<span id="list:test_std_vertx-6"><a href="#list:test_std_vertx-6" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">completeNow</span><span class="op">();</span></span>
<span id="list:test_std_vertx-7"><a href="#list:test_std_vertx-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Per gestire correttamente le operazioni asincrone, sono stati
adottati i seguenti accorgimenti:</p>
<ul>
<li><p>utilizzo del decoratore <em>@Timeout</em> fornito da JUnit
Jupiter, che consente di impostare un limite di tempo oltre il quale il
test fallisce automaticamente, utile per gestire servizi esterni che non
rispondono;</p></li>
<li><p>uso asincrono del <em>VertxTestContext</em>, che consente di
completare il test solo quando tutte le operazioni asincrone sono
terminate;</p></li>
<li><p>introduzione, nei servizi, di una struttura di risposta che
include una chiave <code>"error"</code> in caso di fallimento, poiché il
test non può accedere direttamente alla risposta HTTP e quindi allo
status code.</p></li>
</ul>
<p>Il seguente esempio mostra un test asincrono correttamente
strutturato:</p>
<div class="sourceCode" id="list:test_async_vertx" data-language="Java"
data-caption="Esempio di test asincrono con Vert.x"
data-label="list:test_async_vertx"><pre
class="sourceCode java"><code class="sourceCode java"><span id="list:test_async_vertx-1"><a href="#list:test_async_vertx-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Timeout</span><span class="op">(</span>value <span class="op">=</span> <span class="dv">10</span><span class="op">,</span> unit <span class="op">=</span> <span class="bu">TimeUnit</span><span class="op">.</span><span class="fu">SECONDS</span><span class="op">)</span></span>
<span id="list:test_async_vertx-2"><a href="#list:test_async_vertx-2" aria-hidden="true" tabindex="-1"></a><span class="at">@Test</span></span>
<span id="list:test_async_vertx-3"><a href="#list:test_async_vertx-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">testGetShuffledDeckOK</span><span class="op">(</span><span class="dt">final</span> VertxTestContext context<span class="op">)</span> <span class="op">{</span></span>
<span id="list:test_async_vertx-4"><a href="#list:test_async_vertx-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> JsonObject gameResponse <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">gameService</span><span class="op">.</span><span class="fu">createGame</span><span class="op">(</span></span>
<span id="list:test_async_vertx-5"><a href="#list:test_async_vertx-5" aria-hidden="true" tabindex="-1"></a>        <span class="dv">4</span><span class="op">,</span> TEST_USER<span class="op">,</span> <span class="dv">41</span><span class="op">,</span> GameMode<span class="op">.</span><span class="fu">CLASSIC</span><span class="op">.</span><span class="fu">toString</span><span class="op">(),</span> PASSWORD<span class="op">);</span></span>
<span id="list:test_async_vertx-6"><a href="#list:test_async_vertx-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">businessLogicController</span></span>
<span id="list:test_async_vertx-7"><a href="#list:test_async_vertx-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">getShuffledDeck</span><span class="op">(</span><span class="bu">UUID</span><span class="op">.</span><span class="fu">fromString</span><span class="op">(</span>gameResponse<span class="op">.</span><span class="fu">getString</span><span class="op">(</span>Constants<span class="op">.</span><span class="fu">GAME_ID</span><span class="op">)),</span> <span class="dv">4</span><span class="op">)</span></span>
<span id="list:test_async_vertx-8"><a href="#list:test_async_vertx-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">whenComplete</span><span class="op">((</span>res<span class="op">,</span> err<span class="op">)</span> <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="list:test_async_vertx-9"><a href="#list:test_async_vertx-9" aria-hidden="true" tabindex="-1"></a>            context<span class="op">.</span><span class="fu">verify</span><span class="op">(()</span> <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="list:test_async_vertx-10"><a href="#list:test_async_vertx-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">assertNull</span><span class="op">(</span>res<span class="op">.</span><span class="fu">getString</span><span class="op">(</span><span class="st">&quot;error&quot;</span><span class="op">));</span></span>
<span id="list:test_async_vertx-11"><a href="#list:test_async_vertx-11" aria-hidden="true" tabindex="-1"></a>                context<span class="op">.</span><span class="fu">completeNow</span><span class="op">();</span></span>
<span id="list:test_async_vertx-12"><a href="#list:test_async_vertx-12" aria-hidden="true" tabindex="-1"></a>            <span class="op">});</span></span>
<span id="list:test_async_vertx-13"><a href="#list:test_async_vertx-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">});</span></span>
<span id="list:test_async_vertx-14"><a href="#list:test_async_vertx-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="livelli-superiori-della-piramide">Livelli Superiori della
Piramide</h2>
<p>I livelli superiori della test pyramid — in particolare gli
<em>end-to-end test</em>, che secondo <span class="citation"
data-cites="richardson2019"></span> dovrebbero essere minimizzati data
la loro complessità, lentezza e fragilità — non sono stati implementati
in forma automatizzata. La verifica del comportamento complessivo
dell’applicazione è stata condotta tramite sessioni di <em>alpha
testing</em> con più utenti attraverso il frontend, coprendo in modo
esplorativo i percorsi principali dell’utente (<em>user
journey</em>).</p>
<h1 id="ch:production_ready">Micro-servizi production ready(Assignement
7)</h1>
<h2 id="sicurezza">Sicurezza</h2>
<p>La parte di sicurezza è relativamente semplice nel progetto
MaraffaOnline, viene utilizzato una form login con utente/passwword e
questi vengono passati al servizio degli utente che verifica la validatà
e rilascia un authorization bearer che viene salvato all’interno del
browser per poter autorizzare tutte le successive chiamate ai servizi,
che comunque non sono mai dirette ma vengono sempre intercettate dal
servizio di API gatetway che ne controlla la validità. Dato il dominio
non ci sono permessi differenti in base alle tipologie di utenti, visto
che sono tutti giocatori.</p>
<h2 id="configurabilità">Configurabilità</h2>
<p>Il sistema è stato studiato per poter essere pienamente configurabile
sfruttando le funzionalità offerte da docker e in particolare docker
swarm, ogni servizio è in grado di leggere le proprie configurazioni di
sistema da un file ’.env’.</p>
<h2 id="osservabilità">Osservabilità</h2>
<h3 id="health-check-api">Health check API</h3>
<p>In ogni servizio creato ad-hoc per il progetto sono state inserite le
API per il controllo di health, forniscono un test di liveness del
sistema tramite uno status code 200 e inoltre sono state aggiunte
metriche di ogni servizio che potrebbero risultare utili in uno scenario
di deploy in cui è importante conoscere lo spazio su disco utlizzato da
ogni servizio e che percentuale occupa. All’interno dello stack, su ogni
container, vengono chiamate queste API periodicamente per poter
assicurare che non ci siano down di servizi.</p>
<div class="sourceCode" id="list:healt_API" data-language="Python"
data-caption="Health check API" data-label="list:healt_API"><pre
class="sourceCode python"><code class="sourceCode python"><span id="list:healt_API-1"><a href="#list:healt_API-1" aria-hidden="true" tabindex="-1"></a>healthcheck:</span>
<span id="list:healt_API-2"><a href="#list:healt_API-2" aria-hidden="true" tabindex="-1"></a>      test:</span>
<span id="list:healt_API-3"><a href="#list:healt_API-3" aria-hidden="true" tabindex="-1"></a>        [</span>
<span id="list:healt_API-4"><a href="#list:healt_API-4" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;CMD&quot;</span>, </span>
<span id="list:healt_API-5"><a href="#list:healt_API-5" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;curl&quot;</span>, <span class="st">&quot;-f&quot;</span>, <span class="st">&quot;http://localhost:3000/actuator/health&quot;</span>, <span class="st">&quot;||&quot;</span>, </span>
<span id="list:healt_API-6"><a href="#list:healt_API-6" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;curl&quot;</span>, <span class="st">&quot;-f&quot;</span>, <span class="st">&quot;http://localhost:3000/health&quot;</span>, <span class="st">&quot;||&quot;</span>, </span>
<span id="list:healt_API-7"><a href="#list:healt_API-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;curl&quot;</span>, <span class="st">&quot;-f&quot;</span>, <span class="st">&quot;http://localhost:3000/&quot;</span>, <span class="st">&quot;||&quot;</span>,<span class="st">&quot;exit&quot;</span>,<span class="st">&quot;1&quot;</span>,</span>
<span id="list:healt_API-8"><a href="#list:healt_API-8" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="list:healt_API-9"><a href="#list:healt_API-9" aria-hidden="true" tabindex="-1"></a>      interval: <span class="dv">30</span><span class="er">s</span></span>
<span id="list:healt_API-10"><a href="#list:healt_API-10" aria-hidden="true" tabindex="-1"></a>      timeout: <span class="dv">10</span><span class="er">s</span></span>
<span id="list:healt_API-11"><a href="#list:healt_API-11" aria-hidden="true" tabindex="-1"></a>      retries: <span class="dv">3</span></span>
<span id="list:healt_API-12"><a href="#list:healt_API-12" aria-hidden="true" tabindex="-1"></a>      start_period: <span class="dv">60</span><span class="er">s</span></span></code></pre></div>
<h3 id="log-aggregation">Log aggregation</h3>
<figure id="log_aggregation">
<img src="report/img/dashboard-aggregate-logging.png"
style="width:16cm" />
<figcaption aria-hidden="true"></figcaption>
</figure>
<h3 id="log-tracing">Log Tracing</h3>
<figure id="log_tracing">
<img src="report/img/logging-service.png" style="width:16cm" />
<figcaption aria-hidden="true"></figcaption>
</figure>
<h3 id="tracing-servizi">Tracing servizi</h3>
<figure id="service_tracing">
<img src="report/img/Jaeger-UI.png" style="width:16cm" />
<figcaption aria-hidden="true"></figcaption>
</figure>
<div class="appendices">
<h1 id="appn:A">An Appendix Chapter (Optional)</h1>
<p>Some lengthy tables, codes, raw data, length proofs, etc. which are
<strong>very important but not essential part</strong> of the project
report goes into an Appendix. An appendix is something a reader would
consult if he/she needs extra information and a more comprehensive
understating of the report. Also, note that you should use one appendix
for one idea.</p>
<p>An appendix is optional. If you feel you do not need to include an
appendix in your report, avoid including it. Sometime including
irrelevant and unnecessary materials in the Appendices may unreasonably
increase the total number of pages in your report and distract the
reader.</p>
<h1 id="appn:B">An Appendix Chapter (Optional)</h1>
<p>...</p>
</div>
            </div>
    </div>
  </div>
  <script src="https://vjs.zencdn.net/5.4.4/video.js"></script>

</body>
</html>
