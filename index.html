<!doctype html>
<html >
<head>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <!--[if lt IE 9]>
                <script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
        <![endif]-->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />

    <!-- <link rel="stylesheet" type="text/css" href="template.css" /> -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/template.css" />

    <link href="https://vjs.zencdn.net/5.4.4/video-js.css" rel="stylesheet" />

    <script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>
    <!-- <script type='text/javascript' src='menu/js/jquery.cookie.js'></script> -->
    <!-- <script type='text/javascript' src='menu/js/jquery.hoverIntent.minified.js'></script> -->
    <!-- <script type='text/javascript' src='menu/js/jquery.dcjqaccordion.2.7.min.js'></script> -->

    <!-- <link href="menu/css/skins/blue.css" rel="stylesheet" type="text/css" /> -->
    <!-- <link href="menu/css/skins/graphite.css" rel="stylesheet" type="text/css" /> -->
    <!-- <link href="menu/css/skins/grey.css" rel="stylesheet" type="text/css" /> -->
  
    <!-- <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> -->
        
  
    <!-- <script src="script.js"></script> -->
  
    <!-- <script src="jquery.sticky-kit.js "></script> -->
    <script type='text/javascript' src='https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/js/jquery.cookie.js'></script>
    <script type='text/javascript' src='https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/js/jquery.hoverIntent.minified.js'></script>
    <script type='text/javascript' src='https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/js/jquery.dcjqaccordion.2.7.min.js'></script>

    <link href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/css/skins/blue.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/css/skins/graphite.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/css/skins/grey.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/gh/ryangrose/easy-pandoc-templates@948e28e5/css/elegant_bootstrap.css" rel="stylesheet" type="text/css" />
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  
    <script src="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/script.js"></script>
  
    <script src="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/jquery.sticky-kit.js"></script>
    <meta name="generator" content="pandoc" />
  <title>Relazione progetto MaraffaOnline - SAP</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #ffffff;
    color: #a0a0a0;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
div.sourceCode
  { color: #1f1c1b; background-color: #ffffff; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #1f1c1b; } /* Normal */
code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
code span.an { color: #ca60ca; } /* Annotation */
code span.at { color: #0057ae; } /* Attribute */
code span.bn { color: #b08000; } /* BaseN */
code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code span.ch { color: #924c9d; } /* Char */
code span.cn { color: #aa5500; } /* Constant */
code span.co { color: #898887; } /* Comment */
code span.cv { color: #0095ff; } /* CommentVar */
code span.do { color: #607880; } /* Documentation */
code span.dt { color: #0057ae; } /* DataType */
code span.dv { color: #b08000; } /* DecVal */
code span.er { color: #bf0303; text-decoration: underline; } /* Error */
code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code span.fl { color: #b08000; } /* Float */
code span.fu { color: #644a9b; } /* Function */
code span.im { color: #ff5500; } /* Import */
code span.in { color: #b08000; } /* Information */
code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code span.op { color: #1f1c1b; } /* Operator */
code span.ot { color: #006e28; } /* Other */
code span.pp { color: #006e28; } /* Preprocessor */
code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #ff5500; } /* SpecialString */
code span.st { color: #bf0303; } /* String */
code span.va { color: #0057ae; } /* Variable */
code span.vs { color: #bf0303; } /* VerbatimString */
code span.wa { color: #bf0303; } /* Warning */
  </style>
</head>
<body>

    
    <div class="navbar navbar-static-top">
    <div class="navbar-inner">
      <div class="container">
        <span class="doc-title">Relazione progetto MaraffaOnline -
SAP</span>
        <ul class="nav pull-right doc-info">
                            </ul>
      </div>
    </div>
  </div>
    <div class="container">
    <div class="row">
            <div id="TOC" class="span3">
        <div class="well toc">

        <ul>
        <li><a href="#declaration"
        id="toc-declaration">Declaration</a></li>
        <li><a href="#abstract" id="toc-abstract">Abstract</a>
        <ul>
        <li><a href="#list-of-abbreviations"
        id="toc-list-of-abbreviations">List of Abbreviations</a></li>
        </ul></li>
        <li><a href="#ch:into" id="toc-ch:into">Introduction</a></li>
        <li><a href="#ch:decomposition"
        id="toc-ch:decomposition">Decomoposizione da monolite a
        micro-servizi(Assignement 5)</a>
        <ul>
        <li><a href="#operazioni-di-sistema"
        id="toc-operazioni-di-sistema">Operazioni di sistema</a>
        <ul>
        <li><a
        href="#knowledge-crunching-session-for-the-exploration-of-the-problem-space"
        id="toc-knowledge-crunching-session-for-the-exploration-of-the-problem-space">Knowledge
        crunching session for the exploration of the problem
        space</a></li>
        <li><a href="#casi-duso" id="toc-casi-duso">Casi d’uso</a></li>
        </ul></li>
        <li><a href="#decomposizione-in-servizi"
        id="toc-decomposizione-in-servizi">Decomposizione in servizi</a>
        <ul>
        <li><a href="#bounded-context" id="toc-bounded-context">Bounded
        Context</a></li>
        <li><a href="#schema-architettura"
        id="toc-schema-architettura">Schema architettura</a></li>
        </ul></li>
        <li><a href="#comunicazione-tra-servizi"
        id="toc-comunicazione-tra-servizi">Comunicazione tra servizi</a>
        <ul>
        <li><a href="#api-gateway" id="toc-api-gateway">API
        gateway</a></li>
        <li><a href="#websocket-module"
        id="toc-websocket-module">Websocket module</a></li>
        </ul></li>
        </ul></li>
        <li><a href="#chap:QA" id="toc-chap:QA">Quality Attributes</a>
        <ul>
        <li><a href="#operational"
        id="toc-operational">Operational</a></li>
        <li><a href="#structural"
        id="toc-structural">Structural</a></li>
        </ul></li>
        <li><a href="#ch:testing" id="toc-ch:testing">Testing</a>
        <ul>
        <li><a href="#integration-test"
        id="toc-integration-test">Integration Test</a></li>
        <li><a href="#testing-asincrono"
        id="toc-testing-asincrono">Testing asincrono</a></li>
        </ul></li>
        <li><a href="#ch:production_ready"
        id="toc-ch:production_ready">Micro-servizi production
        ready(Assignement 7)</a>
        <ul>
        <li><a href="#sicurezza" id="toc-sicurezza">Sicurezza</a></li>
        <li><a href="#configurabilità"
        id="toc-configurabilità">Configurabilità</a></li>
        <li><a href="#osservabilità"
        id="toc-osservabilità">Osservabilità</a>
        <ul>
        <li><a href="#health-check-api" id="toc-health-check-api">Health
        check API</a></li>
        <li><a href="#log-aggregation" id="toc-log-aggregation">Log
        aggregation</a></li>
        <li><a href="#log-tracing" id="toc-log-tracing">Log
        Tracing</a></li>
        <li><a href="#tracing-servizi" id="toc-tracing-servizi">Tracing
        servizi</a></li>
        </ul></li>
        </ul></li>
        </ul>

        </div>
      </div>
            <div class="span9">

      
      <div class="titlepage">
<div class="center">
<p><span>UNIBO<br />
Department of Computer Science</span><br />
</p>
<p>Relazione progetto MaraffaOnline - SAP</p>
<p> <br />
<span> Matteo Santoro </span><br />
<span> <em>Supervisor:</em> Alessandro ricci</span><br />
</p>
<p>2025-10-30</p>
</div>
</div>
<h1 class="unnumbered" id="declaration">Declaration</h1>
<p>I, Matteo Santoro, del Dipartimento di Informatica dell’Università di
Bologna, confermo che il presente lavoro è di mia proprietà e che le
figure, le tabelle, le equazioni, i frammenti di codice, le opere d’arte
e le illustrazioni contenute in questa relazione sono originali e non
sono state tratte da lavori di altre persone, tranne nei casi in cui i
lavori di altri sono stati esplicitamente riconosciuti, citati e
referenziati. Sono consapevole che, in caso contrario, si configurerà un
caso di plagio. Il plagio è una forma di cattiva condotta accademica e
sarà sanzionato di conseguenza.<br />
 <br />
</p>
<div class="flushright">
<p>Firstname(s) Lastname</p>
<p>2025-10-30</p>
</div>
<h1 class="unnumbered" id="abstract">Abstract</h1>
<p>This is an undergraduate project report template and instruction on
how to write a report. It also has some useful examples to use LaTeX. Do
read this template carefully. The number of chapters and their titles
may vary depending on the type of project and personal preference.
Section titles in this template are illustrative should be updated
accordingly. For example, sections named “A section...” and “Example of
...” should be updated. The number of sections in each chapter may also
vary. This template may or may not suit your project. Discuss the
structure of your report with your supervisor.</p>
<p> <br />
<strong>Guidance on abstract writing:</strong> An abstract is a summary
of a report in a single paragraph up to a maximum of 250 words. An
abstract should be self-contained, and it should not refer to sections,
figures, tables, equations, or references. An abstract typically
consists of sentences describing the following four parts: (1)
introduction (background and purpose of the project), (2) methods, (3)
results and analysis, and (4) conclusions. The distribution of these
four parts of the abstract should reflect the relative proportion of
these parts in the report itself. An abstract starts with a few
sentences describing the project’s general field, comprehensive
background and context, the main purpose of the project; and the problem
statement. A few sentences describe the methods, experiments, and
implementation of the project. A few sentences describe the main results
achieved and their significance. The final part of the abstract
describes the conclusions and the implications of the results to the
relevant field.</p>
<p> <br />
<strong>Keywords:</strong> a maximum of five keywords/keyphrase
separated by commas</p>
<p><strong>Report’s total word count:</strong> we expect a maximum of
20,000 words (excluding reference and appendices) and about 50 - 60
pages. [A good project report can also be written in approximately
10,000 words.]</p>
<h2 id="list-of-abbreviations">List of Abbreviations</h2>
<div class="abbrv">
<p>School of Mathematical, Physical and Computational Sciences</p>
</div>
<h1 id="ch:into">Introduction</h1>
<p>MaraffaOnline è un’applicazione che permette alle persone di giocare
al gioco di carte <a
href="https://it.wikipedia.org/wiki/Marafone_Beccacino">Maraffa/Beccacino</a>.
Il progetto consiste nell’eseguire una manutenzione evolutiva del gioco
di carte reperibile su MaraffaOnline, attualmente sviluppato dalla
prof.ssa Lumini. In particolare la nuova versione avrà un’architettura a
microservizi e introdurrà anche nuove funzionalità come formazione
personalizzata delle squadre, una nuova modalità di gioco (vittoria 11 a
0 in caso di violazione delle regole da parte di una squadra),
salvataggio delle statistiche delle partite e degli utenti, ...<br />
Per lo sviluppo è stato seguito un approccio Domain Driven Design, per
il quale si è approfondito il dominio del gioco.<br />
È stata posta particolare attenzione alle tecniche di continuos
integration, alle quali è stato dedicato uno dei capitoli di questo
report.</p>
<h1 id="ch:decomposition">Decomoposizione da monolite a
micro-servizi(Assignement 5)</h1>
<p>La precedente versione del software era funzionante ma difficile da
mantenere ed aggiornare, data la struttura monolitica. Esisteva un’unico
sorgente che conteneva al suo interno logiche di business, nessun tipo
di persistenza e la view tutti assieme.</p>
<p>Per poter decomporre questo monolite sono state eseguite le fasi
di:</p>
<ul>
<li><p>Identificazione delle operazioni di sistema.</p></li>
<li><p>Decomposizione in servizi, in subdomain seguendo DDD.</p></li>
<li><p>Identificazione di API di comunicazione tra servizi.</p></li>
</ul>
<h2 id="operazioni-di-sistema">Operazioni di sistema</h2>
<h3
id="knowledge-crunching-session-for-the-exploration-of-the-problem-space">Knowledge
crunching session for the exploration of the problem space</h3>
<p>E’ stato utilizzato il metodo Event Storming. La tecnica consiste
nell’individuare degli eventi di dominio e riportarli al passato su un
post-it arancione. Una volta individuati gli eventi, sono stati scritti
su post-it blu i comandi che l’utente svolge per creare l’evento. In
giallo è stato specificato l’attore, la persona che esegue il comando,
mentre in verde la view, l’interfaccia software con la quale l’utente
interagisce. Infine, con delle label si sono aggregati i post-it in
unità di dominio. Si riporta di seguito lo screen della lavagna con i
post-it e la relativa legenda.</p>
<figure id="event_storming">
<p><img src="report/img/EventStorming.png" alt="image" /><br />
</p>
<figcaption>Event Storming</figcaption>
</figure>
<figure id="legend">
<img src="report/img/event_storming_legend.png" />
<figcaption>Event Storming Legend</figcaption>
</figure>
<ol>
<li><p>Account</p>
<ol>
<li><p>Login</p></li>
<li><p>Registrazione</p></li>
<li><p>Recupero password</p></li>
<li><p>Visualizzazione profilo</p></li>
<li><p>Modifica password</p></li>
<li><p>Possibilità di scegliere se giocare come ospite o effettuare il
login</p></li>
</ol></li>
<li><p>Realizzazione partita</p>
<ol>
<li><p>Creazione partita</p></li>
<li><p>Partecipazione partita</p></li>
<li><p>gioca carta</p></li>
<li><p>Inizio partita</p></li>
<li><p>Fine mano</p></li>
<li><p>Fine partita</p></li>
</ol></li>
<li><p>Chat di gioco</p>
<ol>
<li><p>chat globale</p></li>
<li><p>chat partita</p></li>
</ol></li>
<li><p>Possibilità di scegliere un compagno di squadra</p></li>
<li><p>Scelta del seme, parole consentite</p></li>
<li><p>Modalità di gioco 11 a 0</p></li>
<li><p>Gestione punteggio</p>
<ol>
<li><p>Calcolo totale e parziale (Gestione per ogni mano) del
punteggio</p></li>
<li><p>Maraffa/Cricca (+3 punti)</p></li>
</ol></li>
<li><p>Servizio gestione utenti</p></li>
<li><p>Salvataggio statistiche</p></li>
<li><p>Realizzazione GUI</p>
<ol>
<li><p>Refactor della GUI esistente</p></li>
<li><p>Rinnovamento GUI</p></li>
</ol></li>
</ol>
<h3 id="casi-duso">Casi d’uso</h3>
<p>Si riporta di seguito lo schema dei casi d’uso che modella
l’interazione dell’utente con l’applicazione.</p>
<figure id="use_case">
<img src="report/img/Casi_duso.png" />
<figcaption>Schema dei casi d’uso</figcaption>
</figure>
<h2 id="decomposizione-in-servizi">Decomposizione in servizi</h2>
<h3 id="bounded-context">Bounded Context</h3>
<p>Analizzando il dominio di MaraffaOnline, sono stati identificati i
tre principali bounded context che andranno poi a definire (ad alto
livello) i servizi e alcune delle loro API all’interno
dell’architettura. Nella figura si può osservare un primo bounded
context, colorato di azzurro, che modella l’autenticazione
dell’utente:</p>
<ul>
<li><p><strong>User:</strong> persona che possiede l’account</p></li>
<li><p><strong>Statistic:</strong> dati dell’utente relativi al gioco
come numero di vittorie, sconfitte, partite giocate e maraffe</p></li>
<li><p><strong>Authentication:</strong> accesso all’applicativo
MaraffaOnline da parte dell’utente</p></li>
</ul>
<p>Il secondo bounded context, colorato di verde, modella la
partita:</p>
<ul>
<li><p><strong>Game:</strong> partita</p></li>
<li><p><strong>Team:</strong> squadra composta da numero di giocatori /
2</p></li>
<li><p><strong>Score:</strong> punteggio delle due squadre</p></li>
<li><p><strong>Statistic:</strong> dati relativi ai game
giocati</p></li>
<li><p><strong>Trick:</strong> presa di quattro carte da parte di un
giocatore</p></li>
<li><p><strong>Round:</strong> 10 prese</p></li>
<li><p><strong>Card:</strong> carta</p></li>
<li><p><strong>Player:</strong> giocatore</p></li>
<li><p><strong>Deck:</strong> mazzo</p></li>
<li><p><strong>Hand:</strong> carte che ha in mano un giocatore</p></li>
</ul>
<p>Infine l’ultimo, di colore arancione, modella la chat:</p>
<ul>
<li><p><strong>Chat:</strong> chat di gioco</p></li>
<li><p><strong>Message:</strong> messaggio inviato nella chat</p></li>
<li><p><strong>User:</strong> persona che invia il messaggio</p></li>
</ul>
<p>È importante notare che il concetto di user/player è polisemico: vi
sono tre rappresentazioni diverse per afferire allo stesso concetto.</p>
<figure id="bounded_context">
<img src="report/img/BoundedCTX.png" />
<figcaption>Context Map</figcaption>
</figure>
<h3 id="schema-architettura">Schema architettura</h3>
<p><img src="report/img/Architecture.png" style="width:16cm"
alt="image" /><br />
</p>
<h2 id="comunicazione-tra-servizi">Comunicazione tra servizi</h2>
<h3 id="api-gateway">API gateway</h3>
<p>Sono state implementate diverse forme di comunicazione tra servizi in
base alle caratteristiche del messaggio che viene scambiato. Si è scelto
di utilizzare la comunicazione REST nella maggior parte dei servizi,
visto la sua interoperabilità. Non è stato necessario implementare un
vero e proprio broker di messaggi, ma è stato implementato un servizio
denominato middleware che svolge il ruolo di API gatetway delle
richieste dai client verso il sistema.</p>
<p>Queste chiamate non sono obbligatoriamente dirette verso il servizio
interessato, ma possono anche essere routine che effettuano molteplici
chiamate per ottenere il risultato desiderato. Implementare queste
chiamate direttamente nel front-end avrebbe reso il codice molto più
complesso e difficile da mantenere, e la gestione di partite multiple
sarebbe stata molto più complicata.</p>
<p>Non è stato implementato nessun meccanismo di discovery per scoprire
l’indirizzo degli altri servizi, è stato sfruatta la tecnologia built-in
di docker che permette di poter utilizzare degli alias e nascondere al
proprio interno i meccaniscmi di registration, questo comunque implica
che tutto debba essere sempre mantenuto nell’ambiene virtualizzato e
quindi ogni futueo servizio containerizzato.</p>
<p>Si è seguito un approccio modulare nello sviluppo di questo
componente che, in un primo step, conteneva soltanto la logica di
gestione delle partite, al quale sono stati aggiunti i moduli per la
comunicazione con il servizio degli utenti e della business logic. Ogni
modulo segue la stessa struttura, ossia una classe denominata controller
che si occupa esclusivamente della dichiarazione delle rotte HTTP e che
a sua volta contiene un service. Ogni servizio contiene poi le logiche
di calcolo e crea un JSON di risposta che viene passato al controller
che lo invia come risposta HTTP, questo per poter separare completamente
e rispettare il principio di single responsibility.</p>
<p>Nel modulo contenente le logiche di gioco è stato necessario
aggiungere un ulteriore strato di separazione alla struttura
controller-service, data la struttura multi-attore della gestione delle
partite che non permetteva una separazione netta. Quindi è stato
aggiunto, tra il controller e il service, un componente ibrido per poter
comunque avere servizi indipendenti.</p>
<p>Questa separazione, oltre a essere una buona pratica, è stata scelta
per poter effettuare del testing comodamente soltanto sui servizi,
testando quindi solamente la parte relativa all’elaborazione di una
risposta.</p>
<h3 id="websocket-module">Websocket module</h3>
<p>L’interazione con il frontend avviene prevalentemente tramite il
protocollo HTTP, ma per la gestione di alcuni aspetti in tempo reale
sono state introdotte le WebSocket. Questo componente è stato creato, ad
esempio, per la gestione delle chat di gioco, in modo che i giocatori
possano comunicare tra loro in tempo reale. Ogni client, istanziato sul
computer degli utenti, effettua una connessione WebSocket con il
middleware utilizzando come endpoint il proprio UUID, che viene
assegnato automaticamente all’avvio, e lo username del giocatore, dopo
aver effettuato il login. Il middleware contiene al proprio interno una
mappa di tutti i client e giocatori connessi con la relativa WebSocket e
una classe che espone due metodi per inviare messaggi a un singolo
giocatore o effettuare un messaggio broadcast a tutti i giocatori
connessi.</p>
<p>Il modulo di game si occupa di gestire le partite, quindi è l’unico
che può sapere quali giocatori devono ricevere determinati messaggi
relativi a una singola partita. Per utilizzare il servizio di WebSocket,
è stata implementata una semplice interfaccia all’interno dell’attore di
gioco con la quale si effettuano chiamate "onEvent". Ogni volta che un
particolare evento si verifica, un’invocazione a queste chiamate
permette di inviare messaggi alle WebSocket dei giocatori
interessati.</p>
<h1 id="chap:QA">Quality Attributes</h1>
<p>In questa sezione vengono analizzati gli attributi di qualità
(<em>quality attributes</em>) rilevanti per l’architettura del sistema
sviluppato. Si tratta di requisiti non funzionali che influenzano
profondamente le decisioni progettuali e architetturali.</p>
<h2 id="operational">Operational</h2>
<ul>
<li><p>Robustezza: l’interfaccia limita abbastana le operazione che
possono esserer effettuate, rendendo il sistema più robusto.</p></li>
<li><p>Availability/Scalabilità: il sistema è progettato per essere
sempre disponibile, la replica di servizi mirati sul nodo swarm
garantisce che il sistema possa continuare a funzionare anche in caso di
guasti e bilanciarsi.</p></li>
<li><p>Usabilità: l’interfaccia è progettata per essere intuitiva e
facile da usare, con un design che facilita l’interazione dell’utente.
Non è stato previsto nel progetto la creazione di un tutorial o di una
guida, ma si è cercato di rendere l’interfaccia il più semplice
possibile. (Conoscere le regole del gioco di carte è stato considerato
sufficiente per l’utilizzo del sistema).</p></li>
</ul>
<h2 id="structural">Structural</h2>
<ul>
<li><p>Evolvabilità: il sistema è progettato per essere facilmente
estendibile e modificabile, con un’architettura modulare che consente
l’aggiunta di nuove funzionalità senza impattare le parti
esistenti.</p></li>
<li><p>Portabilità: il sistema è progettato per essere facilmente
distribuito su diverse piattaforme e ambienti, grazie all’uso di
tecnologie containerizzate come Docker..</p></li>
</ul>
<h1 id="ch:testing">Testing</h1>
<p>Per ogni servizio di questo sistema è stato adottato, ove possibile,
il paradigma di programmazione TDD (Test Driven Development). Questo
approccio prevede che i test vengano scritti prima del codice, in modo
da guidarne lo sviluppo e garantire che il software prodotto soddisfi i
requisiti specificati.</p>
<p>Le operazioni di testing sono state implementate con
<strong>Jest</strong> per quanto riguarda i servizi basati su Node.js,
generando report chiari e di facile lettura. Il componente middleware,
scritto in Java, produceva invece risultati di test meno comprensibili.
Per risolvere questo problema è stata introdotta, nel file di build
Gradle, una dipendenza che consente di ottenere report più dettagliati e
leggibili.</p>
<p>La libreria <a
href="https://plugins.gradle.org/plugin/com.adarshr.test-logger"><u>Test
Logger</u></a>, tramite una semplice configurazione nel file
<code>build.gradle</code> riportata di seguito.</p>
<div class="sourceCode" id="list:gradle_testlogger" data-language="Java"
data-caption="Configurazione del Test Logger"
data-label="list:gradle_testlogger"><pre
class="sourceCode java"><code class="sourceCode java"><span id="list:gradle_testlogger-1"><a href="#list:gradle_testlogger-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">com</span><span class="op">.</span><span class="im">adarshr</span><span class="op">.</span><span class="im">gradle</span><span class="op">.</span><span class="im">testlogger</span><span class="op">.</span><span class="im">TestLoggerExtension</span></span>
<span id="list:gradle_testlogger-2"><a href="#list:gradle_testlogger-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">com</span><span class="op">.</span><span class="im">adarshr</span><span class="op">.</span><span class="im">gradle</span><span class="op">.</span><span class="im">testlogger</span><span class="op">.</span><span class="im">TestLoggerPlugin</span></span>
<span id="list:gradle_testlogger-3"><a href="#list:gradle_testlogger-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">com</span><span class="op">.</span><span class="im">adarshr</span><span class="op">.</span><span class="im">gradle</span><span class="op">.</span><span class="im">testlogger</span><span class="op">.</span><span class="im">theme</span><span class="op">.</span><span class="im">ThemeType</span></span>
<span id="list:gradle_testlogger-4"><a href="#list:gradle_testlogger-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:gradle_testlogger-5"><a href="#list:gradle_testlogger-5" aria-hidden="true" tabindex="-1"></a>testlogger <span class="op">{</span></span>
<span id="list:gradle_testlogger-6"><a href="#list:gradle_testlogger-6" aria-hidden="true" tabindex="-1"></a>    theme <span class="op">=</span> ThemeType<span class="op">.</span><span class="fu">MOCHA</span></span>
<span id="list:gradle_testlogger-7"><a href="#list:gradle_testlogger-7" aria-hidden="true" tabindex="-1"></a>    showExceptions <span class="op">=</span> <span class="kw">true</span></span>
<span id="list:gradle_testlogger-8"><a href="#list:gradle_testlogger-8" aria-hidden="true" tabindex="-1"></a>    showStackTraces <span class="op">=</span> <span class="kw">true</span></span>
<span id="list:gradle_testlogger-9"><a href="#list:gradle_testlogger-9" aria-hidden="true" tabindex="-1"></a>    showFullStackTraces <span class="op">=</span> <span class="kw">false</span></span>
<span id="list:gradle_testlogger-10"><a href="#list:gradle_testlogger-10" aria-hidden="true" tabindex="-1"></a>    showCauses <span class="op">=</span> <span class="kw">true</span></span>
<span id="list:gradle_testlogger-11"><a href="#list:gradle_testlogger-11" aria-hidden="true" tabindex="-1"></a>    slowThreshold <span class="op">=</span> <span class="dv">2000</span></span>
<span id="list:gradle_testlogger-12"><a href="#list:gradle_testlogger-12" aria-hidden="true" tabindex="-1"></a>    showSummary <span class="op">=</span> <span class="kw">true</span></span>
<span id="list:gradle_testlogger-13"><a href="#list:gradle_testlogger-13" aria-hidden="true" tabindex="-1"></a>    showSimpleNames <span class="op">=</span> <span class="kw">false</span></span>
<span id="list:gradle_testlogger-14"><a href="#list:gradle_testlogger-14" aria-hidden="true" tabindex="-1"></a>    showPassed <span class="op">=</span> <span class="kw">true</span></span>
<span id="list:gradle_testlogger-15"><a href="#list:gradle_testlogger-15" aria-hidden="true" tabindex="-1"></a>    showSkipped <span class="op">=</span> <span class="kw">true</span></span>
<span id="list:gradle_testlogger-16"><a href="#list:gradle_testlogger-16" aria-hidden="true" tabindex="-1"></a>    showFailed <span class="op">=</span> <span class="kw">true</span></span>
<span id="list:gradle_testlogger-17"><a href="#list:gradle_testlogger-17" aria-hidden="true" tabindex="-1"></a>    showOnlySlow <span class="op">=</span> <span class="kw">false</span></span>
<span id="list:gradle_testlogger-18"><a href="#list:gradle_testlogger-18" aria-hidden="true" tabindex="-1"></a>    showStandardStreams <span class="op">=</span> <span class="kw">false</span></span>
<span id="list:gradle_testlogger-19"><a href="#list:gradle_testlogger-19" aria-hidden="true" tabindex="-1"></a>    showPassedStandardStreams <span class="op">=</span> <span class="kw">true</span></span>
<span id="list:gradle_testlogger-20"><a href="#list:gradle_testlogger-20" aria-hidden="true" tabindex="-1"></a>    showSkippedStandardStreams <span class="op">=</span> <span class="kw">true</span></span>
<span id="list:gradle_testlogger-21"><a href="#list:gradle_testlogger-21" aria-hidden="true" tabindex="-1"></a>    showFailedStandardStreams <span class="op">=</span> <span class="kw">true</span></span>
<span id="list:gradle_testlogger-22"><a href="#list:gradle_testlogger-22" aria-hidden="true" tabindex="-1"></a>    logLevel <span class="op">=</span> LogLevel<span class="op">.</span><span class="fu">LIFECYCLE</span></span>
<span id="list:gradle_testlogger-23"><a href="#list:gradle_testlogger-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>L’architettura dei componenti può essere riassunta come segue:</p>
<ul>
<li><p><strong>Classi controller</strong>: espongono le rotte e
contengono al loro interno le classi di servizio.</p></li>
<li><p><strong>Classi di servizio</strong>: contengono la logica di
business.</p></li>
</ul>
<p>Gli <em>unit test</em> vengono eseguiti sulle classi di servizio,
verificando la correttezza della logica di business. Questo approccio
permette di ottenere una maggiore copertura del codice e di garantire
che la logica applicativa sia corretta.</p>
<h3 id="integration-test">Integration Test</h3>
<p>Poiché l’architettura adottata è di tipo <em>microservices</em>, è
necessario testare anche il corretto funzionamento delle comunicazioni
tra i vari servizi. A tal fine sono stati implementati dei test di
integrazione, che verificano la corretta esposizione e interazione delle
API tra i servizi.</p>
<p>Questi test sono stati realizzati principalmente all’interno del
componente middleware, che si occupa di mettere in comunicazione i
servizi tra loro e con il frontend, verificando così che i controller
degli altri servizi rispondessero correttamente e che i contenuti
venissero deserializzati in modo corretto. Non sono stati quindi creati
<em>unit test</em> sui controller interni ai singoli servizi, poiché il
loro comportamento viene testato indirettamente attraverso il
middleware.</p>
<p>Ad eccezione del servizio contenente la <em>business logic</em> — che
non ha interazioni con database né dipendenze da altri servizi — sono
stati realizzati test di integrazione per verificare il corretto
collegamento tra i servizi che utilizzano database, sia relazionali che
non.</p>
<div class="sourceCode" id="list:mongo_test" data-language="Java"
data-caption="Esempio di test di integrazione per MongoDB"
data-label="list:mongo_test"><pre class="sourceCode java"><code class="sourceCode java"><span id="list:mongo_test-1"><a href="#list:mongo_test-1" aria-hidden="true" tabindex="-1"></a><span class="at">@TestInstance</span><span class="op">(</span>Lifecycle<span class="op">.</span><span class="fu">PER_CLASS</span><span class="op">)</span></span>
<span id="list:mongo_test-2"><a href="#list:mongo_test-2" aria-hidden="true" tabindex="-1"></a><span class="at">@ExtendWith</span><span class="op">(</span>VertxExtension<span class="op">.</span><span class="fu">class</span><span class="op">)</span></span>
<span id="list:mongo_test-3"><a href="#list:mongo_test-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> StatisticMongoTest <span class="op">{</span></span>
<span id="list:mongo_test-4"><a href="#list:mongo_test-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> <span class="dt">int</span> TRICKS <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="list:mongo_test-5"><a href="#list:mongo_test-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">final</span> User userTest <span class="op">=</span> <span class="kw">new</span> <span class="fu">User</span><span class="op">(</span><span class="st">&quot;user&quot;</span><span class="op">,</span> <span class="bu">UUID</span><span class="op">.</span><span class="fu">randomUUID</span><span class="op">(),</span> <span class="kw">false</span><span class="op">);</span></span>
<span id="list:mongo_test-6"><a href="#list:mongo_test-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> <span class="dt">int</span> MARAFFA_PLAYERS <span class="op">=</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="list:mongo_test-7"><a href="#list:mongo_test-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> <span class="dt">int</span> EXPECTED_SCORE <span class="op">=</span> <span class="dv">11</span><span class="op">;</span></span>
<span id="list:mongo_test-8"><a href="#list:mongo_test-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> <span class="bu">String</span> PASSWORD <span class="op">=</span> <span class="st">&quot;1234&quot;</span><span class="op">;</span></span>
<span id="list:mongo_test-9"><a href="#list:mongo_test-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> GameMode GAME_MODE <span class="op">=</span> GameMode<span class="op">.</span><span class="fu">CLASSIC</span><span class="op">;</span></span>
<span id="list:mongo_test-10"><a href="#list:mongo_test-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> Vertx vertx<span class="op">;</span></span>
<span id="list:mongo_test-11"><a href="#list:mongo_test-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> GameService gameService<span class="op">;</span></span>
<span id="list:mongo_test-12"><a href="#list:mongo_test-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> CardSuit UNDEFINED_TRUMP <span class="op">=</span> CardSuit<span class="op">.</span><span class="fu">NONE</span><span class="op">;</span></span>
<span id="list:mongo_test-13"><a href="#list:mongo_test-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">final</span> Card<span class="op">&lt;</span>CardSuit<span class="op">,</span> CardValue<span class="op">&gt;</span> cardTest <span class="op">=</span> <span class="kw">new</span> Card<span class="op">&lt;&gt;(</span>CardValue<span class="op">.</span><span class="fu">THREE</span><span class="op">,</span> CardSuit<span class="op">.</span><span class="fu">CLUBS</span><span class="op">);</span></span>
<span id="list:mongo_test-14"><a href="#list:mongo_test-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">final</span> <span class="bu">Boolean</span> isSuitFinished <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="list:mongo_test-15"><a href="#list:mongo_test-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">final</span> MongoStatisticManager mongoStatisticManager <span class="op">=</span> <span class="kw">new</span> <span class="fu">MongoStatisticManager</span><span class="op">(</span></span>
<span id="list:mongo_test-16"><a href="#list:mongo_test-16" aria-hidden="true" tabindex="-1"></a>        Dotenv<span class="op">.</span><span class="fu">configure</span><span class="op">().</span><span class="fu">filename</span><span class="op">(</span><span class="st">&quot;env.example&quot;</span><span class="op">).</span><span class="fu">load</span><span class="op">().</span><span class="fu">get</span><span class="op">(</span><span class="st">&quot;MONGO_USER&quot;</span><span class="op">,</span> <span class="st">&quot;user&quot;</span><span class="op">),</span></span>
<span id="list:mongo_test-17"><a href="#list:mongo_test-17" aria-hidden="true" tabindex="-1"></a>        Dotenv<span class="op">.</span><span class="fu">configure</span><span class="op">().</span><span class="fu">filename</span><span class="op">(</span><span class="st">&quot;env.example&quot;</span><span class="op">).</span><span class="fu">load</span><span class="op">().</span><span class="fu">get</span><span class="op">(</span><span class="st">&quot;MONGO_PASSWORD&quot;</span><span class="op">,</span> <span class="st">&quot;password&quot;</span><span class="op">),</span></span>
<span id="list:mongo_test-18"><a href="#list:mongo_test-18" aria-hidden="true" tabindex="-1"></a>        Dotenv<span class="op">.</span><span class="fu">configure</span><span class="op">().</span><span class="fu">filename</span><span class="op">(</span><span class="st">&quot;env.example&quot;</span><span class="op">).</span><span class="fu">load</span><span class="op">().</span><span class="fu">get</span><span class="op">(</span><span class="st">&quot;MONGO_HOST&quot;</span><span class="op">,</span> <span class="st">&quot;localhost&quot;</span><span class="op">),</span></span>
<span id="list:mongo_test-19"><a href="#list:mongo_test-19" aria-hidden="true" tabindex="-1"></a>        <span class="bu">Integer</span><span class="op">.</span><span class="fu">parseInt</span><span class="op">(</span>Dotenv<span class="op">.</span><span class="fu">configure</span><span class="op">().</span><span class="fu">filename</span><span class="op">(</span><span class="st">&quot;env.example&quot;</span><span class="op">).</span><span class="fu">load</span><span class="op">().</span><span class="fu">get</span><span class="op">(</span><span class="st">&quot;MONGO_PORT&quot;</span><span class="op">,</span> <span class="st">&quot;27127&quot;</span><span class="op">)),</span></span>
<span id="list:mongo_test-20"><a href="#list:mongo_test-20" aria-hidden="true" tabindex="-1"></a>        Dotenv<span class="op">.</span><span class="fu">configure</span><span class="op">().</span><span class="fu">filename</span><span class="op">(</span><span class="st">&quot;env.example&quot;</span><span class="op">).</span><span class="fu">load</span><span class="op">().</span><span class="fu">get</span><span class="op">(</span><span class="st">&quot;MONGO_DATABASE&quot;</span><span class="op">,</span> <span class="st">&quot;maraffa-test&quot;</span><span class="op">)</span></span>
<span id="list:mongo_test-21"><a href="#list:mongo_test-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="list:mongo_test-22"><a href="#list:mongo_test-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:mongo_test-23"><a href="#list:mongo_test-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">@BeforeAll</span></span>
<span id="list:mongo_test-24"><a href="#list:mongo_test-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">setUp</span><span class="op">()</span> <span class="op">{</span></span>
<span id="list:mongo_test-25"><a href="#list:mongo_test-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">vertx</span> <span class="op">=</span> Vertx<span class="op">.</span><span class="fu">vertx</span><span class="op">();</span></span>
<span id="list:mongo_test-26"><a href="#list:mongo_test-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">gameService</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">GameService</span><span class="op">(</span><span class="kw">this</span><span class="op">.</span><span class="fu">vertx</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="fu">mongoStatisticManager</span><span class="op">);</span></span>
<span id="list:mongo_test-27"><a href="#list:mongo_test-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="list:mongo_test-28"><a href="#list:mongo_test-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:mongo_test-29"><a href="#list:mongo_test-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">@AfterAll</span></span>
<span id="list:mongo_test-30"><a href="#list:mongo_test-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">tearDown</span><span class="op">()</span> <span class="op">{</span></span>
<span id="list:mongo_test-31"><a href="#list:mongo_test-31" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">vertx</span><span class="op">.</span><span class="fu">close</span><span class="op">();</span></span>
<span id="list:mongo_test-32"><a href="#list:mongo_test-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="list:mongo_test-33"><a href="#list:mongo_test-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="list:mongo_test-34"><a href="#list:mongo_test-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Test</span></span>
<span id="list:mongo_test-35"><a href="#list:mongo_test-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">prepareGame</span><span class="op">()</span> <span class="op">{</span></span>
<span id="list:mongo_test-36"><a href="#list:mongo_test-36" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="bu">String</span> gameID <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">gameService</span></span>
<span id="list:mongo_test-37"><a href="#list:mongo_test-37" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">createGame</span><span class="op">(</span>MARAFFA_PLAYERS<span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="fu">userTest</span><span class="op">,</span> EXPECTED_SCORE<span class="op">,</span> GAME_MODE<span class="op">.</span><span class="fu">toString</span><span class="op">())</span></span>
<span id="list:mongo_test-38"><a href="#list:mongo_test-38" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">getString</span><span class="op">(</span>Constants<span class="op">.</span><span class="fu">GAME_ID</span><span class="op">);</span></span>
<span id="list:mongo_test-39"><a href="#list:mongo_test-39" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">var</span> doc <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">mongoStatisticManager</span><span class="op">.</span><span class="fu">getRecord</span><span class="op">(</span>gameID <span class="op">+</span> <span class="st">&quot;-0&quot;</span><span class="op">);</span></span>
<span id="list:mongo_test-40"><a href="#list:mongo_test-40" aria-hidden="true" tabindex="-1"></a>        <span class="fu">assertNotNull</span><span class="op">(</span>doc<span class="op">);</span></span>
<span id="list:mongo_test-41"><a href="#list:mongo_test-41" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="list:mongo_test-42"><a href="#list:mongo_test-42" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="testing-asincrono">Testing asincrono</h3>
<p>Durante la scrittura dei test del servizio Java, alcune operazioni
risultavano asincrone; è stato quindi necessario attendere il
completamento di tali operazioni prima di poter validare i test. La
struttura di test standard fornita da Vert.x non era sufficiente in un
primo momento. La forma classica dei test è la seguente:</p>
<div class="sourceCode" id="list:test_std_vertx" data-language="Java"
data-caption="Esempio di test standard con Vert.x"
data-label="list:test_std_vertx"><pre
class="sourceCode java"><code class="sourceCode java"><span id="list:test_std_vertx-1"><a href="#list:test_std_vertx-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Test</span></span>
<span id="list:test_std_vertx-2"><a href="#list:test_std_vertx-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">createGameTest</span><span class="op">(</span><span class="dt">final</span> VertxTestContext context<span class="op">)</span> <span class="op">{</span></span>
<span id="list:test_std_vertx-3"><a href="#list:test_std_vertx-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> JsonObject gameResponse <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">gameService</span><span class="op">.</span><span class="fu">createGame</span><span class="op">(</span></span>
<span id="list:test_std_vertx-4"><a href="#list:test_std_vertx-4" aria-hidden="true" tabindex="-1"></a>        MARAFFA_PLAYERS<span class="op">,</span> TEST_USER<span class="op">,</span> EXPECTED_SCORE<span class="op">,</span> GAME_MODE<span class="op">.</span><span class="fu">toString</span><span class="op">(),</span> PASSWORD<span class="op">);</span></span>
<span id="list:test_std_vertx-5"><a href="#list:test_std_vertx-5" aria-hidden="true" tabindex="-1"></a>    Assertions<span class="op">.</span><span class="fu">assertEquals</span><span class="op">(</span>UUID_SIZE<span class="op">,</span> gameResponse<span class="op">.</span><span class="fu">getString</span><span class="op">(</span>Constants<span class="op">.</span><span class="fu">GAME_ID</span><span class="op">).</span><span class="fu">length</span><span class="op">());</span></span>
<span id="list:test_std_vertx-6"><a href="#list:test_std_vertx-6" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">completeNow</span><span class="op">();</span></span>
<span id="list:test_std_vertx-7"><a href="#list:test_std_vertx-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Per gestire correttamente le operazioni asincrone, sono stati
adottati i seguenti accorgimenti:</p>
<ul>
<li><p>utilizzo del decoratore <em>@Timeout</em> fornito da JUnit
Jupiter, che consente di impostare un limite di tempo oltre il quale il
test fallisce automaticamente, utile per gestire servizi esterni che non
rispondono;</p></li>
<li><p>uso asincrono del <em>VertxTestContext</em>, che consente di
completare il test solo quando tutte le operazioni asincrone sono
terminate;</p></li>
<li><p>introduzione, nei servizi, di una struttura di risposta che
include una chiave <code>"error"</code> in caso di fallimento, poiché il
test non può accedere direttamente alla risposta HTTP e quindi allo
status code.</p></li>
</ul>
<p>Il seguente esempio mostra un test asincrono correttamente
strutturato:</p>
<div class="sourceCode" id="list:test_async_vertx" data-language="Java"
data-caption="Esempio di test asincrono con Vert.x"
data-label="list:test_async_vertx"><pre
class="sourceCode java"><code class="sourceCode java"><span id="list:test_async_vertx-1"><a href="#list:test_async_vertx-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Timeout</span><span class="op">(</span>value <span class="op">=</span> <span class="dv">10</span><span class="op">,</span> unit <span class="op">=</span> <span class="bu">TimeUnit</span><span class="op">.</span><span class="fu">SECONDS</span><span class="op">)</span></span>
<span id="list:test_async_vertx-2"><a href="#list:test_async_vertx-2" aria-hidden="true" tabindex="-1"></a><span class="at">@Test</span></span>
<span id="list:test_async_vertx-3"><a href="#list:test_async_vertx-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">testGetShuffledDeckOK</span><span class="op">(</span><span class="dt">final</span> VertxTestContext context<span class="op">)</span> <span class="op">{</span></span>
<span id="list:test_async_vertx-4"><a href="#list:test_async_vertx-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> JsonObject gameResponse <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">gameService</span><span class="op">.</span><span class="fu">createGame</span><span class="op">(</span></span>
<span id="list:test_async_vertx-5"><a href="#list:test_async_vertx-5" aria-hidden="true" tabindex="-1"></a>        <span class="dv">4</span><span class="op">,</span> TEST_USER<span class="op">,</span> <span class="dv">41</span><span class="op">,</span> GameMode<span class="op">.</span><span class="fu">CLASSIC</span><span class="op">.</span><span class="fu">toString</span><span class="op">(),</span> PASSWORD<span class="op">);</span></span>
<span id="list:test_async_vertx-6"><a href="#list:test_async_vertx-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">businessLogicController</span></span>
<span id="list:test_async_vertx-7"><a href="#list:test_async_vertx-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">getShuffledDeck</span><span class="op">(</span><span class="bu">UUID</span><span class="op">.</span><span class="fu">fromString</span><span class="op">(</span>gameResponse<span class="op">.</span><span class="fu">getString</span><span class="op">(</span>Constants<span class="op">.</span><span class="fu">GAME_ID</span><span class="op">)),</span> <span class="dv">4</span><span class="op">)</span></span>
<span id="list:test_async_vertx-8"><a href="#list:test_async_vertx-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">whenComplete</span><span class="op">((</span>res<span class="op">,</span> err<span class="op">)</span> <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="list:test_async_vertx-9"><a href="#list:test_async_vertx-9" aria-hidden="true" tabindex="-1"></a>            context<span class="op">.</span><span class="fu">verify</span><span class="op">(()</span> <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="list:test_async_vertx-10"><a href="#list:test_async_vertx-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">assertNull</span><span class="op">(</span>res<span class="op">.</span><span class="fu">getString</span><span class="op">(</span><span class="st">&quot;error&quot;</span><span class="op">));</span></span>
<span id="list:test_async_vertx-11"><a href="#list:test_async_vertx-11" aria-hidden="true" tabindex="-1"></a>                context<span class="op">.</span><span class="fu">completeNow</span><span class="op">();</span></span>
<span id="list:test_async_vertx-12"><a href="#list:test_async_vertx-12" aria-hidden="true" tabindex="-1"></a>            <span class="op">});</span></span>
<span id="list:test_async_vertx-13"><a href="#list:test_async_vertx-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">});</span></span>
<span id="list:test_async_vertx-14"><a href="#list:test_async_vertx-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Infine, gli ulteriori livelli di testing sono stati accorpati e
verificati durante la fase di <em>alpha testing</em> dell’applicazione,
condotta da più utenti tramite il servizio di frontend.</p>
<h1 id="ch:production_ready">Micro-servizi production ready(Assignement
7)</h1>
<h2 id="sicurezza">Sicurezza</h2>
<p>La parte di sicurezza è relativamente semplice nel progetto
MaraffaOnline, viene utilizzato una form login con utente/passwword e
questi vengono passati al servizio degli utente che verifica la validatà
e rilascia un authorization bearer che viene salvato all’interno del
browser per poter autorizzare tutte le successive chiamate ai servizi,
che comunque non sono mai dirette ma vengono sempre intercettate dal
servizio di API gatetway che ne controlla la validità. Dato il dominio
non ci sono permessi differenti in base alle tipologie di utenti, visto
che sono tutti giocatori.</p>
<h2 id="configurabilità">Configurabilità</h2>
<p>Il sistema è stato studiato per poter essere pienamente configurabile
sfruttando le funzionalità offerte da docker e in particolare docker
swarm, ogni servizio è in grado di leggere le proprie configurazioni di
sistema da un file ’.env’.</p>
<h2 id="osservabilità">Osservabilità</h2>
<h3 id="health-check-api">Health check API</h3>
<p>In ogni servizio creato ad-hoc per il progetto sono state inserite le
API per il controllo di health, forniscono un test di liveness del
sistema tramite uno status code 200 e inoltre sono state aggiunte
metriche di ogni servizio che potrebbero risultare utili in uno scenario
di deploy in cui è importante conoscere lo spazio su disco utlizzato da
ogni servizio e che percentuale occupa. All’interno dello stack, su ogni
container, vengono chiamate queste API periodicamente per poter
assicurare che non ci siano down di servizi.</p>
<div class="sourceCode" id="list:healt_API" data-language="Python"
data-caption="Health check API" data-label="list:healt_API"><pre
class="sourceCode python"><code class="sourceCode python"><span id="list:healt_API-1"><a href="#list:healt_API-1" aria-hidden="true" tabindex="-1"></a>healthcheck:</span>
<span id="list:healt_API-2"><a href="#list:healt_API-2" aria-hidden="true" tabindex="-1"></a>      test:</span>
<span id="list:healt_API-3"><a href="#list:healt_API-3" aria-hidden="true" tabindex="-1"></a>        [</span>
<span id="list:healt_API-4"><a href="#list:healt_API-4" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;CMD&quot;</span>, </span>
<span id="list:healt_API-5"><a href="#list:healt_API-5" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;curl&quot;</span>, <span class="st">&quot;-f&quot;</span>, <span class="st">&quot;http://localhost:3000/actuator/health&quot;</span>, <span class="st">&quot;||&quot;</span>, </span>
<span id="list:healt_API-6"><a href="#list:healt_API-6" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;curl&quot;</span>, <span class="st">&quot;-f&quot;</span>, <span class="st">&quot;http://localhost:3000/health&quot;</span>, <span class="st">&quot;||&quot;</span>, </span>
<span id="list:healt_API-7"><a href="#list:healt_API-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;curl&quot;</span>, <span class="st">&quot;-f&quot;</span>, <span class="st">&quot;http://localhost:3000/&quot;</span>, <span class="st">&quot;||&quot;</span>,<span class="st">&quot;exit&quot;</span>,<span class="st">&quot;1&quot;</span>,</span>
<span id="list:healt_API-8"><a href="#list:healt_API-8" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="list:healt_API-9"><a href="#list:healt_API-9" aria-hidden="true" tabindex="-1"></a>      interval: <span class="dv">30</span><span class="er">s</span></span>
<span id="list:healt_API-10"><a href="#list:healt_API-10" aria-hidden="true" tabindex="-1"></a>      timeout: <span class="dv">10</span><span class="er">s</span></span>
<span id="list:healt_API-11"><a href="#list:healt_API-11" aria-hidden="true" tabindex="-1"></a>      retries: <span class="dv">3</span></span>
<span id="list:healt_API-12"><a href="#list:healt_API-12" aria-hidden="true" tabindex="-1"></a>      start_period: <span class="dv">60</span><span class="er">s</span></span></code></pre></div>
<h3 id="log-aggregation">Log aggregation</h3>
<figure id="log_aggregation">
<img src="report/img/dashboard-aggregate-logging.png"
style="width:16cm" />
<figcaption aria-hidden="true"></figcaption>
</figure>
<h3 id="log-tracing">Log Tracing</h3>
<figure id="log_tracing">
<img src="report/img/logging-service.png" style="width:16cm" />
<figcaption aria-hidden="true"></figcaption>
</figure>
<h3 id="tracing-servizi">Tracing servizi</h3>
<figure id="service_tracing">
<img src="report/img/Jaeger-UI.png" style="width:16cm" />
<figcaption aria-hidden="true"></figcaption>
</figure>
<div class="appendices">
<h1 id="appn:A">An Appendix Chapter (Optional)</h1>
<p>Some lengthy tables, codes, raw data, length proofs, etc. which are
<strong>very important but not essential part</strong> of the project
report goes into an Appendix. An appendix is something a reader would
consult if he/she needs extra information and a more comprehensive
understating of the report. Also, note that you should use one appendix
for one idea.</p>
<p>An appendix is optional. If you feel you do not need to include an
appendix in your report, avoid including it. Sometime including
irrelevant and unnecessary materials in the Appendices may unreasonably
increase the total number of pages in your report and distract the
reader.</p>
<h1 id="appn:B">An Appendix Chapter (Optional)</h1>
<p>...</p>
</div>
            </div>
    </div>
  </div>
  <script src="https://vjs.zencdn.net/5.4.4/video.js"></script>

</body>
</html>
